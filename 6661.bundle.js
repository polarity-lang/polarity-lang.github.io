"use strict";(self.webpackChunkmonaco_lsp_streams=self.webpackChunkmonaco_lsp_streams||[]).push([[6661],{24619:(e,t,i)=>{e.exports=i.p+"874a968008f3c6125b20.wasm"},76661:(e,t,i)=>{i.r(t),i.d(t,{ITextMateTokenizationService:()=>r.S,default:()=>Fe});var n,o=i(25202),r=i(76044),s=i(82015),a=i(92518),c=i(30787),d=i(71478),g=i(19871),l=i(97634);class h{constructor(e,t,i){this.id=e,this.dependencies=t,this.callback=i}}!function(e){e[e.Uninitialized=1]="Uninitialized",e[e.InitializedInternal=2]="InitializedInternal",e[e.InitializedExternal=3]="InitializedExternal"}(n||(n={}));class u{static{this.INSTANCE=new u}constructor(){this._isWebWorker="object"==typeof self&&self.constructor&&"DedicatedWorkerGlobalScope"===self.constructor.name,this._isRenderer="object"==typeof document,this._defineCalls=[],this._state=n.Uninitialized}_initialize(){this._state===n.Uninitialized&&(globalThis.define?this._state=n.InitializedExternal:(this._state=n.InitializedInternal,globalThis.define=(e,t,i)=>{"string"!=typeof e&&(i=t,t=e,e=null),"object"==typeof t&&Array.isArray(t)||(i=t,t=null),this._defineCalls.push(new h(e,t,i))},globalThis.define.amd=!0,this._isRenderer?this._amdPolicy=globalThis._VSCODE_WEB_PACKAGE_TTP??window.trustedTypes?.createPolicy("amdLoader",{createScriptURL(e){if(e.startsWith(window.location.origin))return e;if(e.startsWith(`${c.ny.vscodeFileResource}://${c.B8}`))return e;throw new Error(`[trusted_script_src] Invalid script url: ${e}`)}}):this._isWebWorker&&(this._amdPolicy=globalThis._VSCODE_WEB_PACKAGE_TTP??globalThis.trustedTypes?.createPolicy("amdLoader",{createScriptURL:e=>e}))))}async load(e){if(this._initialize(),this._state===n.InitializedExternal)return new Promise((t=>{const i=(0,l.b)();globalThis.define(i,[e],(function(e){t(e)}))}));const t=await(this._isWebWorker?this._workerLoadScript(e):this._isRenderer?this._rendererLoadScript(e):this._nodeJSLoadScript(e));if(!t)return void console.warn(`Did not receive a define call from script ${e}`);const i={},o=[],r=[];if(Array.isArray(t.dependencies))for(const e of t.dependencies)"exports"===e?o.push(i):r.push(e);if(r.length>0)throw new Error(`Cannot resolve dependencies for script ${e}. The dependencies are: ${r.join(", ")}`);return"function"==typeof t.callback?t.callback(...o)??i:t.callback}_rendererLoadScript(e){return new Promise(((t,i)=>{const n=document.createElement("script");n.setAttribute("async","async"),n.setAttribute("type","text/javascript");const o=()=>{n.removeEventListener("load",r),n.removeEventListener("error",s)},r=e=>{o(),t(this._defineCalls.pop())},s=e=>{o(),i(e)};n.addEventListener("load",r),n.addEventListener("error",s),this._amdPolicy&&(e=this._amdPolicy.createScriptURL(e)),n.setAttribute("src",e),window.document.getElementsByTagName("head")[0].appendChild(n)}))}async _workerLoadScript(e){return this._amdPolicy&&(e=this._amdPolicy.createScriptURL(e)),await i(29794)(e).then((e=>e.default??e)),this._defineCalls.pop()}async _nodeJSLoadScript(e){try{const t=(await i.e(4387).then(i.t.bind(i,4387,19)).then((e=>e.default??e))).default,n=(await i.e(5940).then(i.t.bind(i,95940,19)).then((e=>e.default??e))).default,o=(await i.e(1886).then(i.t.bind(i,61886,19)).then((e=>e.default??e))).default,r=g.rz.parse(e).fsPath,s=t.readFileSync(r).toString(),a=o.wrap(s.replace(/^#!.*/,""));return new n.Script(a).runInThisContext().apply(),this._defineCalls.pop()}catch(e){throw e}}}var m=i(68836),p=i(87427),_=i(10442),f=i(53658),k=i(24821),y=i(1661),v=i(19430),T=(i(76815),i(29870)),S=i(35147),w=i(85412),b=i(1180),C=i(71730),L=i(4239),x=i(76975),z=i(25934),I=i(819),E=i(53059),M=i(28672),P=i(30875),N=i(54521),D=i(91193),A=i(84793),j=i(85105),O=i(55262),B=i(75335);class R extends k.jG{constructor(e,t,i,n,o,r,s){super(),this._grammar=e,this._initialState=t,this._containsEmbeddedLanguages=i,this._createBackgroundTokenizer=n,this._backgroundTokenizerShouldOnlyVerifyTokens=o,this._reportTokenizationTime=r,this._reportSlowTokenization=s,this._seenLanguages=[],this._onDidEncounterLanguage=this._register(new y.vl),this.onDidEncounterLanguage=this._onDidEncounterLanguage.event}get backgroundTokenizerShouldOnlyVerifyTokens(){return this._backgroundTokenizerShouldOnlyVerifyTokens()}getInitialState(){return this._initialState}tokenize(e,t,i){throw new Error("Not supported!")}createBackgroundTokenizer(e,t){if(this._createBackgroundTokenizer)return this._createBackgroundTokenizer(e,t)}tokenizeEncoded(e,t,i){const n=1e4*Math.random()<1,o=this._reportSlowTokenization||n,r=o?new O.W(!0):void 0,s=this._grammar.tokenizeLine2(e,i,500);if(o){const t=r.elapsed();(n||t>32)&&this._reportTokenizationTime(t,e.length,n)}if(s.stoppedEarly)return console.warn(`Time limit reached when tokenizing line: ${e.substring(0,100)}`),new C.rY(s.tokens,i);if(this._containsEmbeddedLanguages){const e=this._seenLanguages,t=s.tokens;for(let i=0,n=t.length>>>1;i<n;i++){const n=t[1+(i<<1)],o=B.x.getLanguageId(n);e[o]||(e[o]=!0,this._onDidEncounterLanguage.fire(o))}}let a;return a=i.equals(s.ruleStack)?i:s.ruleStack,new C.rY(s.tokens,a)}}var F=i(70205);class $ extends k.jG{get backgroundTokenizerShouldOnlyVerifyTokens(){return this._actual.backgroundTokenizerShouldOnlyVerifyTokens}constructor(e,t,i,n){super(),this._encodedLanguageId=e,this._actual=t,this._maxTokenizationLineLength=n,this._register((0,S.wp)(this._maxTokenizationLineLength)),this._register(i)}getInitialState(){return this._actual.getInitialState()}tokenize(e,t,i){throw new Error("Not supported!")}tokenizeEncoded(e,t,i){return e.length>=this._maxTokenizationLineLength.get()?(0,F.Lh)(this._encodedLanguageId,i):this._actual.tokenizeEncoded(e,t,i)}createBackgroundTokenizer(e,t){return this._actual.createBackgroundTokenizer?this._actual.createBackgroundTokenizer(e,t):void 0}}var G=i(96181);class W{static{this.CHANNEL_NAME="textMateWorkerHost"}static getChannel(e){return e.getChannel(W.CHANNEL_NAME)}static setChannel(e,t){e.setChannel(W.CHANNEL_NAME,t)}}var Q=i(88445),V=i(85570),H=i(87944),U=i(7985),q=i(86674),J=i(14970);class Y{constructor(e){this.edits=e.slice().sort((0,p.VE)((e=>e.offset),p.U9))}applyToArray(e){for(let t=this.edits.length-1;t>=0;t--){const i=this.edits[t];e.splice(i.offset,i.length,...new Array(i.newLength))}}}class Z{constructor(e,t,i){this.offset=e,this.length=t,this.newLength=i}toString(){return`[${this.offset}, +${this.length}) -> +${this.newLength}}`}}class K{static fromMany(e){const t=e.map((e=>new K(e)));return new X(t)}constructor(e){this.transformation=e,this.idx=0,this.offset=0}transform(e){let t=this.transformation.edits[this.idx];for(;t&&t.offset+t.length<=e;)this.offset+=t.newLength-t.length,this.idx++,t=this.transformation.edits[this.idx];if(!(t&&t.offset<=e))return e+this.offset}}class X{constructor(e){this.transformers=e}transform(e){for(const t of this.transformers){const i=t.transform(e);if(void 0===i)return;e=i}return e}}class ee extends k.jG{static{this._id=0}constructor(e,t,i,n,o,r){super(),this._model=e,this._worker=t,this._languageIdCodec=i,this._backgroundTokenizationStore=n,this._configurationService=o,this._maxTokenizationLineLength=r,this.controllerId=ee._id++,this._pendingChanges=[],this._states=new U.CQ,this._loggingEnabled=(0,J.V)("editor.experimental.asyncTokenizationLogging",!1,this._configurationService),this._register((0,S.wp)(this._loggingEnabled)),this._register(this._model.onDidChangeContent((e=>{this._shouldLog&&console.log("model change",{fileName:this._model.uri.fsPath.split("\\").pop(),changes:ie(e.changes)}),this._worker.$acceptModelChanged(this.controllerId,e),this._pendingChanges.push(e)}))),this._register(this._model.onDidChangeLanguage((e=>{const t=this._model.getLanguageId(),i=this._languageIdCodec.encodeLanguageId(t);this._worker.$acceptModelLanguageChanged(this.controllerId,t,i)})));const s=this._model.getLanguageId(),a=this._languageIdCodec.encodeLanguageId(s);this._worker.$acceptNewModel({uri:this._model.uri,versionId:this._model.getVersionId(),lines:this._model.getLinesContent(),EOL:this._model.getEOL(),languageId:s,encodedLanguageId:a,maxTokenizationLineLength:this._maxTokenizationLineLength.get(),controllerId:this.controllerId}),this._register((0,v.fm)((e=>{const t=this._maxTokenizationLineLength.read(e);this._worker.$acceptMaxTokenizationLineLength(this.controllerId,t)})))}dispose(){super.dispose(),this._worker.$acceptRemovedModel(this.controllerId)}requestTokens(e,t){this._worker.$retokenize(this.controllerId,e,t)}async setTokensAndStates(e,t,n,o){if(this.controllerId!==e)return;let r=q.Z.deserialize(new Uint8Array(n));if(this._shouldLog&&console.log("received background tokenization result",{fileName:this._model.uri.fsPath.split("\\").pop(),updatedTokenLines:r.map((e=>e.getLineRange())).join(" & "),updatedStateLines:o.map((e=>new V.M(e.startLineNumber,e.startLineNumber+e.stateDeltas.length).toString())).join(" & ")}),this._shouldLog){const e=this._pendingChanges.filter((e=>e.versionId<=t)).map((e=>e.changes)).map((e=>ie(e))).join(" then ");console.log("Applying changes to local states",e)}for(;this._pendingChanges.length>0&&this._pendingChanges[0].versionId<=t;){const e=this._pendingChanges.shift();this._states.acceptChanges(e.changes)}if(this._pendingChanges.length>0){if(this._shouldLog){const e=this._pendingChanges.map((e=>e.changes)).map((e=>ie(e))).join(" then ");console.log("Considering non-processed changes",e)}const e=K.fromMany(this._pendingChanges.map((e=>te(e.changes)))),t=new q.Z;for(const i of r)for(let n=i.startLineNumber;n<=i.endLineNumber;n++)void 0!==e.transform(n-1)&&t.add(n,i.getLineTokens(n));r=t.finalize();for(const e of this._pendingChanges)for(const t of e.changes)for(let e=0;e<r.length;e++)r[e].applyEdit(t.range,t.text)}const s=K.fromMany(this._pendingChanges.map((e=>te(e.changes))));if(!this._applyStateStackDiffFn||!this._initialState){const{applyStateStackDiff:e,INITIAL:t}=await i.e(5726).then(i.t.bind(i,25726,19)).then((e=>e.default??e));this._applyStateStackDiffFn=e,this._initialState=t}for(const e of o){let t=e.startLineNumber<=1?this._initialState:this._states.getEndState(e.startLineNumber-1);for(let i=0;i<e.stateDeltas.length;i++){const n=e.stateDeltas[i];let o;n?(o=this._applyStateStackDiffFn(t,n),this._states.setEndState(e.startLineNumber+i,o)):o=this._states.getEndState(e.startLineNumber+i);const r=s.transform(e.startLineNumber+i-1);void 0!==r&&this._backgroundTokenizationStore.setEndState(r+1,o),e.startLineNumber+i>=this._model.getLineCount()-1&&this._backgroundTokenizationStore.backgroundTokenizationFinished(),t=o}}this._backgroundTokenizationStore.setTokens(r)}get _shouldLog(){return this._loggingEnabled.get()}}function te(e){return new Y(e.map((e=>new Z(e.range.startLineNumber-1,e.range.endLineNumber-e.range.startLineNumber+1,(0,Q.W)(e.text)[0]+1))))}function ie(e){return e.map((e=>H.Q.lift(e.range).toString()+" => "+e.text)).join(" & ")}var ne,oe=i(94413);let re=class{static{ne=this}static{this._reportedMismatchingTokens=!1}constructor(e,t,i,n,o,r,s,a){this._reportTokenizationTime=e,this._shouldTokenizeAsync=t,this._extensionResourceLoaderService=i,this._configurationService=n,this._languageService=o,this._environmentService=r,this._notificationService=s,this._telemetryService=a,this._workerProxyPromise=null,this._worker=null,this._workerProxy=null,this._workerTokenizerControllers=new Map,this._currentTheme=null,this._currentTokenColorMap=null,this._grammarDefinitions=[]}dispose(){this._disposeWorker()}createBackgroundTokenizer(e,t,i){if(!this._shouldTokenizeAsync()||e.isTooLargeForSyncing())return;const n=new k.Cm,o=this._getWorkerProxy().then((o=>{if(n.isDisposed||!o)return;const r={controller:void 0,worker:this._worker};return n.add(function(e,t){const i=new k.Cm,n=i.add(new k.Cm);function o(){e.isAttachedToEditor()?n.add(t()):n.clear()}return o(),i.add(e.onDidChangeAttached((()=>{o()}))),i}(e,(()=>{const n=new ee(e,o,this._languageService.languageIdCodec,t,this._configurationService,i);return r.controller=n,this._workerTokenizerControllers.set(n.controllerId,n),(0,k.s)((()=>{r.controller=void 0,this._workerTokenizerControllers.delete(n.controllerId),n.dispose()}))}))),r}));return{dispose(){n.dispose()},requestTokens:async(e,t)=>{const i=await o;i?.controller&&i.worker===this._worker&&i.controller.requestTokens(e,t)},reportMismatchingTokens:e=>{ne._reportedMismatchingTokens||(ne._reportedMismatchingTokens=!0,this._notificationService.error({message:"Async Tokenization Token Mismatch in line "+e,name:"Async Tokenization Token Mismatch"}),this._telemetryService.publicLog2("asyncTokenizationMismatchingTokens",{}))}}}setGrammarDefinitions(e){this._grammarDefinitions=e,this._disposeWorker()}acceptTheme(e,t){this._currentTheme=e,this._currentTokenColorMap=t,this._currentTheme&&this._currentTokenColorMap&&this._workerProxy&&this._workerProxy.$acceptTheme(this._currentTheme,this._currentTokenColorMap)}_getWorkerProxy(){return this._workerProxyPromise||(this._workerProxyPromise=this._createWorkerProxy()),this._workerProxyPromise}async _createWorkerProxy(){const e=`${c.dy}/vscode-oniguruma/release/onig.wasm`,t={grammarDefinitions:this._grammarDefinitions,onigurumaWASMUri:c.zl.asBrowserUri(e).toString(!0)},i=this._worker=(0,oe.V3)("vs/workbench/services/textMate/browser/backgroundTokenization/worker/textMateTokenizationWorker.worker","TextMateWorker");return W.setChannel(i,{$readFile:async e=>{const t=g.rz.revive(e);return this._extensionResourceLoaderService.readExtensionResource(t)},$setTokensAndStates:async(e,t,i,n)=>{const o=this._workerTokenizerControllers.get(e);o&&o.setTokensAndStates(e,t,i,n)},$reportTokenizationTime:(e,t,i,n,o)=>{this._reportTokenizationTime(e,t,i,n,o)}}),await i.proxy.$init(t),this._worker!==i?null:(this._workerProxy=i.proxy,this._currentTheme&&this._currentTokenColorMap&&this._workerProxy.$acceptTheme(this._currentTheme,this._currentTokenColorMap),i.proxy)}_disposeWorker(){for(const e of this._workerTokenizerControllers.values())e.dispose();this._workerTokenizerControllers.clear(),this._worker&&(this._worker.dispose(),this._worker=null),this._workerProxy=null,this._workerProxyPromise=null}};re=ne=(0,a.C)([(0,a.Q)(2,E.j),(0,a.Q)(3,I.p),(0,a.Q)(4,L.L),(0,a.Q)(5,G.k),(0,a.Q)(6,N.O),(0,a.Q)(7,A.k)],re);class se{constructor(){this._scopeNameToLanguageRegistration=Object.create(null)}reset(){this._scopeNameToLanguageRegistration=Object.create(null)}register(e){this._scopeNameToLanguageRegistration[e.scopeName]=e}getGrammarDefinition(e){return this._scopeNameToLanguageRegistration[e]||null}}const ae="No TM Grammar registered for this language.";class ce extends k.jG{constructor(e,t,i,n){super(),this._host=e,this._initialState=i.INITIAL,this._scopeRegistry=new se,this._injections={},this._injectedEmbeddedLanguages={},this._languageToScope=new Map,this._grammarRegistry=this._register(new i.Registry({onigLib:n,loadGrammar:async e=>{const t=this._scopeRegistry.getGrammarDefinition(e);if(!t)return this._host.logTrace(`No grammar found for scope ${e}`),null;const n=t.location;try{const e=await this._host.readFile(n);return i.parseRawGrammar(e,n.path)}catch(t){return this._host.logError(`Unable to load and parse grammar for scope ${e} from ${n}`,t),null}},getInjections:e=>{const t=e.split(".");let i=[];for(let e=1;e<=t.length;e++){const n=t.slice(0,e).join(".");i=[...i,...this._injections[n]||[]]}return i}}));for(const e of t){if(this._scopeRegistry.register(e),e.injectTo){for(const t of e.injectTo){let i=this._injections[t];i||(this._injections[t]=i=[]),i.push(e.scopeName)}if(e.embeddedLanguages)for(const t of e.injectTo){let i=this._injectedEmbeddedLanguages[t];i||(this._injectedEmbeddedLanguages[t]=i=[]),i.push(e.embeddedLanguages)}}e.language&&this._languageToScope.set(e.language,e.scopeName)}}has(e){return this._languageToScope.has(e)}setTheme(e,t){this._grammarRegistry.setTheme(e,t)}getColorMap(){return this._grammarRegistry.getColorMap()}async createGrammar(e,t){const i=this._languageToScope.get(e);if("string"!=typeof i)throw new Error(ae);const n=this._scopeRegistry.getGrammarDefinition(i);if(!n)throw new Error(ae);const o=n.embeddedLanguages;if(this._injectedEmbeddedLanguages[i]){const e=this._injectedEmbeddedLanguages[i];for(const t of e)for(const e of Object.keys(t))o[e]=t[e]}const r=Object.keys(o).length>0;let s;try{s=await this._grammarRegistry.loadGrammarWithConfiguration(i,t,{embeddedLanguages:o,tokenTypes:n.tokenTypes,balancedBracketSelectors:n.balancedBracketSelectors,unbalancedBracketSelectors:n.unbalancedBracketSelectors})}catch(e){if(e.message&&e.message.startsWith("No grammar provided for"))throw new Error(ae);throw e}return{languageId:e,grammar:s,initialState:this._initialState,containsEmbeddedLanguages:r,sourceExtensionId:n.sourceExtensionId}}}var de=i(52808),ge=i(316);const le=de.g1.registerExtensionPoint({extensionPoint:"grammars",deps:[ge.b],jsonSchema:{description:(0,z.kg)(7037,"Contributes textmate tokenizers."),type:"array",defaultSnippets:[{body:[{language:"${1:id}",scopeName:"source.${2:id}",path:"./syntaxes/${3:id}.tmLanguage."}]}],items:{type:"object",defaultSnippets:[{body:{language:"${1:id}",scopeName:"source.${2:id}",path:"./syntaxes/${3:id}.tmLanguage."}}],properties:{language:{description:(0,z.kg)(7038,"Language identifier for which this syntax is contributed to."),type:"string"},scopeName:{description:(0,z.kg)(7039,"Textmate scope name used by the tmLanguage file."),type:"string"},path:{description:(0,z.kg)(7040,"Path of the tmLanguage file. The path is relative to the extension folder and typically starts with './syntaxes/'."),type:"string"},embeddedLanguages:{description:(0,z.kg)(7041,"A map of scope name to language id if this grammar contains embedded languages."),type:"object"},tokenTypes:{description:(0,z.kg)(7042,"A map of scope name to token types."),type:"object",additionalProperties:{enum:["string","comment","other"]}},injectTo:{description:(0,z.kg)(7043,"List of language scope names to which this grammar is injected to."),type:"array",items:{type:"string"}},balancedBracketScopes:{description:(0,z.kg)(7044,"Defines which scope names contain balanced brackets."),type:"array",items:{type:"string"},default:["*"]},unbalancedBracketScopes:{description:(0,z.kg)(7045,"Defines which scope names do not contain balanced brackets."),type:"array",items:{type:"string"},default:[]}},required:["scopeName","path"]}}});var he,ue=i(94717);let me=class extends k.jG{static{he=this}static{this.reportTokenizationTimeCounter={sync:0,async:0}}constructor(e,t,i,n,o,r,s,a,c,d){super(),this._languageService=e,this._themeService=t,this._extensionResourceLoaderService=i,this._notificationService=n,this._logService=o,this._configurationService=r,this._progressService=s,this._environmentService=a,this._instantiationService=c,this._telemetryService=d,this._createdModes=[],this._encounteredLanguages=[],this._debugMode=!1,this._debugModePrintFunc=()=>{},this._grammarDefinitions=null,this._grammarFactory=null,this._tokenizersRegistrations=new k.Cm,this._currentTheme=null,this._currentTokenColorMap=null,this._threadedBackgroundTokenizerFactory=this._instantiationService.createInstance(re,((e,t,i,n,o)=>this._reportTokenizationTime(e,t,i,n,!0,o)),(()=>this.getAsyncTokenizationEnabled())),this._vscodeOniguruma=null,this._styleElement=(0,m.li)(),this._styleElement.className="vscode-tokens-styles",le.setHandler((e=>this._handleGrammarsExtPoint(e))),this._updateTheme(this._themeService.getColorTheme(),!0),this._register(this._themeService.onDidColorThemeChange((()=>{this._updateTheme(this._themeService.getColorTheme(),!1)}))),this._register(this._languageService.onDidRequestRichLanguageFeatures((e=>{this._createdModes.push(e)})))}getAsyncTokenizationEnabled(){return!!this._configurationService.getValue("editor.experimental.asyncTokenization")}getAsyncTokenizationVerification(){return!!this._configurationService.getValue("editor.experimental.asyncTokenizationVerification")}_handleGrammarsExtPoint(e){this._grammarDefinitions=null,this._grammarFactory&&(this._grammarFactory.dispose(),this._grammarFactory=null),this._tokenizersRegistrations.clear(),this._grammarDefinitions=[];for(const t of e){const e=t.value;for(const i of e){const e=this._validateGrammarDefinition(t,i);if(e&&(this._grammarDefinitions.push(e),e.language)){const t=new C.v_((()=>this._createTokenizationSupport(e.language)));this._tokenizersRegistrations.add(t),this._tokenizersRegistrations.add(C.dG.registerFactory(e.language,t))}}}this._threadedBackgroundTokenizerFactory.setGrammarDefinitions(this._grammarDefinitions);for(const e of this._createdModes)C.dG.getOrCreate(e)}_validateGrammarDefinition(e,t){if(!function(e,t,i,n){if(t.language&&("string"!=typeof t.language||!n.isRegisteredLanguageId(t.language)))return i.error((0,z.kg)(2606,"Unknown language in `contributes.{0}.language`. Provided value: {1}",le.name,String(t.language))),!1;if(!t.scopeName||"string"!=typeof t.scopeName)return i.error((0,z.kg)(2607,"Expected string in `contributes.{0}.scopeName`. Provided value: {1}",le.name,String(t.scopeName))),!1;if(!t.path||"string"!=typeof t.path)return i.error((0,z.kg)(2608,"Expected string in `contributes.{0}.path`. Provided value: {1}",le.name,String(t.path))),!1;if(t.injectTo&&(!Array.isArray(t.injectTo)||t.injectTo.some((e=>"string"!=typeof e))))return i.error((0,z.kg)(2609,"Invalid value in `contributes.{0}.injectTo`. Must be an array of language scope names. Provided value: {1}",le.name,JSON.stringify(t.injectTo))),!1;if(t.embeddedLanguages&&!(0,b.Gv)(t.embeddedLanguages))return i.error((0,z.kg)(2610,"Invalid value in `contributes.{0}.embeddedLanguages`. Must be an object map from scope name to language. Provided value: {1}",le.name,JSON.stringify(t.embeddedLanguages))),!1;if(t.tokenTypes&&!(0,b.Gv)(t.tokenTypes))return i.error((0,z.kg)(2611,"Invalid value in `contributes.{0}.tokenTypes`. Must be an object map from scope name to token type. Provided value: {1}",le.name,JSON.stringify(t.tokenTypes))),!1;const o=(0,w.uJ)(e,t.path);return(0,w._1)(o,e)||i.warn((0,z.kg)(2612,"Expected `contributes.{0}.path` ({1}) to be included inside extension's folder ({2}). This might make the extension non-portable.",le.name,o.path,e.path)),!0}(e.description.extensionLocation,t,e.collector,this._languageService))return null;const i=(0,w.uJ)(e.description.extensionLocation,t.path),n=Object.create(null);if(t.embeddedLanguages){const e=Object.keys(t.embeddedLanguages);for(let i=0,o=e.length;i<o;i++){const o=e[i],r=t.embeddedLanguages[o];"string"==typeof r&&this._languageService.isRegisteredLanguageId(r)&&(n[o]=this._languageService.languageIdCodec.encodeLanguageId(r))}}const o=Object.create(null);if(t.tokenTypes){const e=Object.keys(t.tokenTypes);for(const i of e)switch(t.tokenTypes[i]){case"string":o[i]=2;break;case"other":o[i]=0;break;case"comment":o[i]=1}}function r(e,t){return Array.isArray(e)&&e.every((e=>"string"==typeof e))?e:t}return{location:i,language:t.language&&this._languageService.isRegisteredLanguageId(t.language)?t.language:void 0,scopeName:t.scopeName,embeddedLanguages:n,tokenTypes:o,injectTo:t.injectTo,balancedBracketSelectors:r(t.balancedBracketScopes,["*"]),unbalancedBracketSelectors:r(t.unbalancedBracketScopes,[]),sourceExtensionId:e.description.id}}startDebugMode(e,t){this._debugMode?this._notificationService.error((0,z.kg)(2602,"Already Logging.")):(this._debugModePrintFunc=e,this._debugMode=!0,this._debugMode&&this._progressService.withProgress({location:15,buttons:[(0,z.kg)(2603,"Stop")]},(e=>(e.report({message:(0,z.kg)(2604,"Preparing to log TM Grammar parsing. Press Stop when finished.")}),this._getVSCodeOniguruma().then((t=>(t.setDefaultDebugCall(!0),e.report({message:(0,z.kg)(2605,"Now logging TM Grammar parsing. Press Stop when finished.")}),new Promise(((e,t)=>{}))))))),(e=>{this._getVSCodeOniguruma().then((e=>{this._debugModePrintFunc=()=>{},this._debugMode=!1,e.setDefaultDebugCall(!1),t()}))})))}_canCreateGrammarFactory(){return!!this._grammarDefinitions}async _getOrCreateGrammarFactory(){if(this._grammarFactory)return this._grammarFactory;const[e,t]=await Promise.all([i.e(5726).then(i.t.bind(i,25726,19)).then((e=>e.default??e)),this._getVSCodeOniguruma()]),n=Promise.resolve({createOnigScanner:e=>t.createOnigScanner(e),createOnigString:e=>t.createOnigString(e)});return this._grammarFactory||(this._grammarFactory=new ce({logTrace:e=>this._logService.trace(e),logError:(e,t)=>this._logService.error(e,t),readFile:e=>this._extensionResourceLoaderService.readExtensionResource(e)},this._grammarDefinitions||[],e,n),this._updateTheme(this._themeService.getColorTheme(),!0)),this._grammarFactory}async _createTokenizationSupport(e){if(!this._languageService.isRegisteredLanguageId(e))return null;if(!this._canCreateGrammarFactory())return null;try{const t=await this._getOrCreateGrammarFactory();if(!t.has(e))return null;const i=this._languageService.languageIdCodec.encodeLanguageId(e),n=await t.createGrammar(e,i);if(!n.grammar)return null;const o=function(e,t,i,n){return(0,S.y0)((i=>n.onDidChangeConfiguration((n=>{n.affectsConfiguration(e,{overrideIdentifier:t})&&i(n)}))),(()=>n.getValue(e,{overrideIdentifier:t})??-1))}("editor.maxTokenizationLineLength",e,0,this._configurationService),r=new R(n.grammar,n.initialState,n.containsEmbeddedLanguages,((e,t)=>this._threadedBackgroundTokenizerFactory.createBackgroundTokenizer(e,t,o)),(()=>this.getAsyncTokenizationVerification()),((t,i,o)=>{this._reportTokenizationTime(t,e,n.sourceExtensionId,i,!1,o)}),!0),s=r.onDidEncounterLanguage((e=>{if(!this._encounteredLanguages[e]){const t=this._languageService.languageIdCodec.decodeLanguageId(e);this._encounteredLanguages[e]=!0,this._languageService.requestBasicLanguageFeatures(t)}}));return new $(i,r,s,o)}catch(e){return e.message&&e.message===ae||(0,f.dz)(e),null}}_updateTheme(e,t){if(!t&&this._currentTheme&&this._currentTokenColorMap&&function(e,t){if(!t||!e||t.length!==e.length)return!1;for(let i=t.length-1;i>=0;i--){const n=t[i],o=e[i];if(n.scope!==o.scope)return!1;const r=n.settings,s=o.settings;if(r&&s){if(r.fontStyle!==s.fontStyle||r.foreground!==s.foreground||r.background!==s.background)return!1}else if(!r||!s)return!1}return!0}(this._currentTheme.settings,e.tokenColors)&&(0,p.aI)(this._currentTokenColorMap,e.tokenColorMap))return;this._currentTheme={name:e.label,settings:e.tokenColors},this._currentTokenColorMap=e.tokenColorMap,this._grammarFactory?.setTheme(this._currentTheme,this._currentTokenColorMap);const i=function(e){const t=[null];for(let i=1,n=e.length;i<n;i++)t[i]=_.Q1.fromHex(e[i]);return t}(this._currentTokenColorMap),n=(0,x.nh)(i);this._styleElement.textContent=n,C.dG.setColorMap(i),this._currentTheme&&this._currentTokenColorMap&&this._threadedBackgroundTokenizerFactory.acceptTheme(this._currentTheme,this._currentTokenColorMap)}async createTokenizer(e){if(!this._languageService.isRegisteredLanguageId(e))return null;const t=await this._getOrCreateGrammarFactory();if(!t.has(e))return null;const i=this._languageService.languageIdCodec.encodeLanguageId(e),{grammar:n}=await t.createGrammar(e,i);return n}_getVSCodeOniguruma(){return this._vscodeOniguruma||(this._vscodeOniguruma=(async()=>{const[e,t]=await Promise.all([i.e(7107).then(i.t.bind(i,27107,19)).then((e=>e.default??e)),this._loadVSCodeOnigurumaWASM()]);return await e.loadWASM({data:t,print:e=>{this._debugModePrintFunc(e)}}),e})()),this._vscodeOniguruma}async _loadVSCodeOnigurumaWASM(){if(d.HZ){const e=await fetch(function(){const e=globalThis._VSCODE_PRODUCT_JSON;Boolean((e??globalThis.vscode?.context?.configuration()?.product)?.commit);const t=`${c.dy}/vscode-oniguruma/release/onig.wasm`;return c.zl.asBrowserUri(t).toString(!0)}());return await e.arrayBuffer()}return await fetch(c.zl.asBrowserUri(`${c.dy}/vscode-oniguruma/release/onig.wasm`).toString(!0))}_reportTokenizationTime(e,t,i,n,o,r){const s=o?"async":"sync";he.reportTokenizationTimeCounter[s]>50||(0===he.reportTokenizationTimeCounter[s]&&setTimeout((()=>{he.reportTokenizationTimeCounter[s]=0}),36e5),he.reportTokenizationTimeCounter[s]++,this._telemetryService.publicLog2("editor.tokenizedLine",{timeMs:e,languageId:t,lineLength:n,fromWorker:o,sourceExtensionId:i,isRandomSample:r,tokenizationSetting:this.getAsyncTokenizationEnabled()?this.getAsyncTokenizationVerification()?2:1:0}))}};me=he=(0,a.C)([(0,a.Q)(0,L.L),(0,a.Q)(1,ue.t),(0,a.Q)(2,E.j),(0,a.Q)(3,N.O),(0,a.Q)(4,P.r),(0,a.Q)(5,I.p),(0,a.Q)(6,D.G),(0,a.Q)(7,j.P),(0,a.Q)(8,M._Y),(0,a.Q)(9,A.k)],me);var pe=i(71512),_e=i(31031),fe=i(8957),ke=i(37784),ye=i(50127),ve=i(87866);const Te=(0,ye.FZ)(),Se=de.g1.registerExtensionPoint({extensionPoint:"semanticTokenTypes",jsonSchema:{description:(0,z.kg)(2613,"Contributes semantic token types."),type:"array",items:{type:"object",properties:{id:{type:"string",description:(0,z.kg)(2614,"The identifier of the semantic token type"),pattern:ye.GE,patternErrorMessage:(0,z.kg)(2615,"Identifiers should be in the form letterOrDigit[_-letterOrDigit]*")},superType:{type:"string",description:(0,z.kg)(2616,"The super type of the semantic token type"),pattern:ye.GE,patternErrorMessage:(0,z.kg)(2617,"Super types should be in the form letterOrDigit[_-letterOrDigit]*")},description:{type:"string",description:(0,z.kg)(2618,"The description of the semantic token type")}}}}}),we=de.g1.registerExtensionPoint({extensionPoint:"semanticTokenModifiers",jsonSchema:{description:(0,z.kg)(2619,"Contributes semantic token modifiers."),type:"array",items:{type:"object",properties:{id:{type:"string",description:(0,z.kg)(2620,"The identifier of the semantic token modifier"),pattern:ye.GE,patternErrorMessage:(0,z.kg)(2621,"Identifiers should be in the form letterOrDigit[_-letterOrDigit]*")},description:{type:"string",description:(0,z.kg)(2622,"The description of the semantic token modifier")}}}}}),be=de.g1.registerExtensionPoint({extensionPoint:"semanticTokenScopes",jsonSchema:{description:(0,z.kg)(2623,"Contributes semantic token scope maps."),type:"array",items:{type:"object",properties:{language:{description:(0,z.kg)(2624,"Lists the languge for which the defaults are."),type:"string"},scopes:{description:(0,z.kg)(2625,"Maps a semantic token (described by semantic token selector) to one or more textMate scopes used to represent that token."),type:"object",additionalProperties:{type:"array",items:{type:"string"}}}}}}});class Ce{constructor(){function e(e,t,i){if("string"!=typeof e.id||0===e.id.length)return i.error((0,z.kg)(2626,"'configuration.{0}.id' must be defined and can not be empty",t)),!1;if(!e.id.match(ye.GE))return i.error((0,z.kg)(2627,"'configuration.{0}.id' must follow the pattern letterOrDigit[-_letterOrDigit]*",t)),!1;const n=e.superType;return n&&!n.match(ye.GE)?(i.error((0,z.kg)(2628,"'configuration.{0}.superType' must follow the pattern letterOrDigit[-_letterOrDigit]*",t)),!1):"string"==typeof e.description&&0!==e.id.length||(i.error((0,z.kg)(2629,"'configuration.{0}.description' must be defined and can not be empty",t)),!1)}Se.setHandler(((t,i)=>{for(const t of i.added){const i=t.value,n=t.collector;if(!i||!Array.isArray(i))return void n.error((0,z.kg)(2630,"'configuration.semanticTokenType' must be an array"));for(const t of i)e(t,"semanticTokenType",n)&&Te.registerTokenType(t.id,t.description,t.superType)}for(const e of i.removed){const t=e.value;for(const e of t)Te.deregisterTokenType(e.id)}})),we.setHandler(((t,i)=>{for(const t of i.added){const i=t.value,n=t.collector;if(!i||!Array.isArray(i))return void n.error((0,z.kg)(2631,"'configuration.semanticTokenModifier' must be an array"));for(const t of i)e(t,"semanticTokenModifier",n)&&Te.registerTokenModifier(t.id,t.description)}for(const e of i.removed){const t=e.value;for(const e of t)Te.deregisterTokenModifier(e.id)}})),be.setHandler(((e,t)=>{for(const e of t.added){const t=e.value,i=e.collector;if(!t||!Array.isArray(t))return void i.error((0,z.kg)(2632,"'configuration.semanticTokenScopes' must be an array"));for(const e of t)if(e.language&&"string"!=typeof e.language)i.error((0,z.kg)(2633,"'configuration.semanticTokenScopes.language' must be a string"));else if(e.scopes&&"object"==typeof e.scopes)for(const t in e.scopes){const n=e.scopes[t];if(Array.isArray(n)&&!n.some((e=>"string"!=typeof e)))try{const i=Te.parseTokenSelector(t,e.language);Te.registerTokenStyleDefault(i,{scopesToProbe:n.map((e=>e.split(" ")))})}catch(e){i.error((0,z.kg)(2636,"configuration.semanticTokenScopes.scopes': Problems parsing selector {0}.",t))}else i.error((0,z.kg)(2635,"'configuration.semanticTokenScopes.scopes' values must be an array of strings"))}else i.error((0,z.kg)(2634,"'configuration.semanticTokenScopes.scopes' must be defined as an object"))}for(const e of t.removed){const t=e.value;for(const e of t)for(const t in e.scopes){const i=e.scopes[t];try{const n=Te.parseTokenSelector(t,e.language);Te.registerTokenStyleDefault(n,{scopesToProbe:i.map((e=>e.split(" ")))})}catch(e){}}}}))}}let Le=class{static{this.ID="workbench.contrib.tokenClassificationExtensionPoint"}constructor(e){this.instantiationService=e,this.instantiationService.createInstance(Ce)}};Le=(0,a.C)([(0,a.Q)(0,M._Y)],Le),(0,ve.tr)(Le.ID,Le,1),(0,i(6162).A)(".token-inspect-widget{border:1px solid var(--vscode-editorHoverWidget-border);padding:10px;user-select:text;-webkit-user-select:text;z-index:50}.hc-black .tokens-inspect-widget,.hc-light .tokens-inspect-widget{border-width:2px}.monaco-editor .token-inspect-widget{background-color:var(--vscode-editorHoverWidget-background)}.monaco-editor .token-inspect-widget .tiw-metadata-separator{background-color:var(--vscode-editorHoverWidget-border)}.tiw-token{font-family:var(--monaco-monospace-font)}.tiw-metadata-separator{border:0;height:1px}.tiw-token-length{float:right;font-size:60%;font-weight:400}.tiw-metadata-table{width:100%}.tiw-metadata-value{font-family:var(--monaco-monospace-font);word-break:break-word}.tiw-metadata-values{list-style:none;margin-right:-10px;max-height:300px;overflow-y:auto;padding-left:0}.tiw-metadata-values>.tiw-metadata-value{margin-right:10px}.tiw-metadata-key{min-width:150px;padding-right:10px;vertical-align:top;white-space:nowrap;width:1px}.tiw-metadata-semantic{font-style:italic}.tiw-metadata-scopes{line-height:normal}.tiw-theme-selector{font-family:var(--monaco-monospace-font)}",{});var xe=i(83909);function ze(e,t,i,n){let o=null;for(let r=e.tokenColors.length-1;r>=0;r--){const s=e.tokenColors[r];if(n&&!s.settings.foreground)continue;let a;if("string"==typeof s.scope)a=s.scope.split(/,/).map((e=>e.trim()));else{if(!Array.isArray(s.scope))continue;a=s.scope}for(let e=0,n=a.length;e<n;e++){const n=a[e],r=new Ie(n,s.settings);r.matches(t,i)&&r.isMoreSpecific(o)&&(o=r)}}return o}class Ie{constructor(e,t){this.rawSelector=e,this.settings=t;const i=this.rawSelector.split(/ /);this.scope=i[i.length-1],this.parentScopes=i.slice(0,i.length-1)}matches(e,t){return Ie._matches(this.scope,this.parentScopes,e,t)}static _cmp(e,t){if(null===e&&null===t)return 0;if(null===e)return-1;if(null===t)return 1;if(e.scope.length!==t.scope.length)return e.scope.length-t.scope.length;const i=e.parentScopes.length,n=t.parentScopes.length;if(i!==n)return i-n;for(let n=0;n<i;n++){const i=e.parentScopes[n].length,o=t.parentScopes[n].length;if(i!==o)return i-o}return 0}isMoreSpecific(e){return Ie._cmp(this,e)>0}static _matchesOne(e,t){const i=e+".";return e===t||t.substring(0,i.length)===i}static _matches(e,t,i,n){if(!this._matchesOne(e,i))return!1;let o=t.length-1,r=n.length-1;for(;o>=0&&r>=0;)this._matchesOne(t[o],n[r])&&o--,r--;return-1===o}}var Ee,Me=i(66194),Pe=i(79237),Ne=i(96433);const De=m.$;let Ae=class extends k.jG{static{Ee=this}static{this.ID="editor.contrib.inspectEditorTokens"}static get(e){return e.getContribution(Ee.ID)}constructor(e,t,i,n,o,r,s,a){super(),this._editor=e,this._textMateService=t,this._treeSitterService=i,this._themeService=o,this._languageService=n,this._notificationService=r,this._configurationService=s,this._languageFeaturesService=a,this._widget=null,this._register(this._editor.onDidChangeModel((e=>this.stop()))),this._register(this._editor.onDidChangeModelLanguage((e=>this.stop()))),this._register(this._editor.onKeyUp((e=>9===e.keyCode&&this.stop())))}dispose(){this.stop(),super.dispose()}launch(){this._widget||this._editor.hasModel()&&this._editor.getModel().uri.scheme!==c.ny.vscodeNotebookCell&&(this._widget=new Be(this._editor,this._textMateService,this._treeSitterService,this._languageService,this._themeService,this._notificationService,this._configurationService,this._languageFeaturesService))}stop(){this._widget&&(this._widget.dispose(),this._widget=null)}toggle(){this._widget?this.stop():this.launch()}};Ae=Ee=(0,a.C)([(0,a.Q)(1,r.S),(0,a.Q)(2,Ne.j),(0,a.Q)(3,L.L),(0,a.Q)(4,ue.t),(0,a.Q)(5,N.O),(0,a.Q)(6,I.p),(0,a.Q)(7,Pe.u)],Ae);class je extends xe.ks{constructor(){super({id:"editor.action.inspectTMScopes",label:(0,z.kg)(2637,"Developer: Inspect Editor Tokens and Scopes"),alias:"Developer: Inspect Editor Tokens and Scopes",precondition:void 0})}run(e,t){const i=Ae.get(t);i?.toggle()}}function Oe(e){e.length>40&&(e=e.substr(0,20)+"…"+e.substr(e.length-20));let t="";for(let i=0,n=e.length;i<n;i++){const n=e.charCodeAt(i);switch(n){case 9:t+="→";break;case 32:t+="·";break;default:t+=String.fromCharCode(n)}}return t}class Be extends k.jG{static{this._ID="editor.contrib.inspectEditorTokensWidget"}constructor(e,t,i,n,o,r,s,a){super(),this.allowEditorOverflow=!0,this._isDisposed=!1,this._editor=e,this._languageService=n,this._themeService=o,this._textMateService=t,this._treeSitterService=i,this._notificationService=r,this._configurationService=s,this._languageFeaturesService=a,this._model=this._editor.getModel(),this._domNode=document.createElement("div"),this._domNode.className="token-inspect-widget",this._currentRequestCancellationTokenSource=new T.Qi,this._beginCompute(this._editor.getPosition()),this._register(this._editor.onDidChangeCursorPosition((e=>this._beginCompute(this._editor.getPosition())))),this._register(o.onDidColorThemeChange((e=>this._beginCompute(this._editor.getPosition())))),this._register(s.onDidChangeConfiguration((e=>e.affectsConfiguration("editor.semanticHighlighting.enabled")&&this._beginCompute(this._editor.getPosition())))),this._editor.addContentWidget(this)}dispose(){this._isDisposed=!0,this._editor.removeContentWidget(this),this._currentRequestCancellationTokenSource.cancel(),super.dispose()}getId(){return Be._ID}_beginCompute(e){const t=this._textMateService.createTokenizer(this._model.getLanguageId()),i=this._computeSemanticTokens(e),n=this._treeSitterService.getParseResult(this._model);(0,m.w_)(this._domNode),this._domNode.appendChild(document.createTextNode((0,z.kg)(2638,"Loading..."))),Promise.all([t,i]).then((([t,i])=>{this._isDisposed||(this._compute(t,i,n?.tree,e),this._domNode.style.maxWidth=`${Math.max(.66*this._editor.getLayoutInfo().width,500)}px`,this._editor.layoutContentWidget(this))}),(e=>{this._notificationService.warn(e),setTimeout((()=>{Ae.get(this._editor)?.stop()}))}))}_isSemanticColoringEnabled(){const e=this._configurationService.getValue(Me.r,{overrideIdentifier:this._model.getLanguageId(),resource:this._model.uri})?.enabled;return"boolean"==typeof e?e:this._themeService.getColorTheme().semanticHighlighting}_compute(e,t,i,n){const o=e&&this._getTokensAtPosition(e,n),r=t&&this._getSemanticTokenAtPosition(t,n),s=i&&this._getTreeSitterTokenAtPosition(i,n);if(!o&&!r&&!s)return void(0,m.Ln)(this._domNode,"No grammar or semantic tokens available.");const a=o?.metadata,c=r?.metadata,d=r&&Oe(this._model.getValueInRange(r.range)),g=o&&Oe(this._model.getLineContent(n.lineNumber).substring(o.token.startIndex,o.token.endIndex)),l=d||g||"";if((0,m.Ln)(this._domNode,De("h2.tiw-token",void 0,l,De("span.tiw-token-length",void 0,`${l.length} ${1===l.length?"char":"chars"}`))),(0,m.BC)(this._domNode,De("hr.tiw-metadata-separator",{style:"clear:both"})),(0,m.BC)(this._domNode,De("table.tiw-metadata-table",void 0,De("tbody",void 0,De("tr",void 0,De("td.tiw-metadata-key",void 0,"language"),De("td.tiw-metadata-value",void 0,a?.languageId||"")),De("tr",void 0,De("td.tiw-metadata-key",void 0,"standard token type"),De("td.tiw-metadata-value",void 0,this._tokenTypeToString(a?.tokenType||0))),...this._formatMetadata(c,a)))),r){(0,m.BC)(this._domNode,De("hr.tiw-metadata-separator"));const e=(0,m.BC)(this._domNode,De("table.tiw-metadata-table",void 0)),t=(0,m.BC)(e,De("tbody",void 0,De("tr",void 0,De("td.tiw-metadata-key",void 0,"semantic token type"),De("td.tiw-metadata-value",void 0,r.type))));if(r.modifiers.length&&(0,m.BC)(t,De("tr",void 0,De("td.tiw-metadata-key",void 0,"modifiers"),De("td.tiw-metadata-value",void 0,r.modifiers.join(" ")))),r.metadata){const e=["foreground","bold","italic","underline","strikethrough"],i={},n=new Array;for(const t of e)if(void 0!==r.metadata[t]){const e=r.definitions[t],o=this._renderTokenStyleDefinition(e,t),s=o.map((e=>(0,m.sb)(e)?e.outerHTML:e)).join();let a=i[s];a||(i[s]=a=[],n.push([o,s])),a.push(t)}for(const[e,o]of n)(0,m.BC)(t,De("tr",void 0,De("td.tiw-metadata-key",void 0,i[o].join(", ")),De("td.tiw-metadata-value",void 0,...e)))}}if(o){const e=this._themeService.getColorTheme();(0,m.BC)(this._domNode,De("hr.tiw-metadata-separator"));const t=(0,m.BC)(this._domNode,De("table.tiw-metadata-table")),i=(0,m.BC)(t,De("tbody"));g&&g!==l&&(0,m.BC)(i,De("tr",void 0,De("td.tiw-metadata-key",void 0,"textmate token"),De("td.tiw-metadata-value",void 0,`${g} (${g.length})`)));const n=new Array;for(let e=o.token.scopes.length-1;e>=0;e--)n.push(o.token.scopes[e]),e>0&&n.push(De("br"));(0,m.BC)(i,De("tr",void 0,De("td.tiw-metadata-key",void 0,"textmate scopes"),De("td.tiw-metadata-value.tiw-metadata-scopes",void 0,...n)));const s=function(e,t,i=!0){for(let n=t.length-1;n>=0;n--){const o=t.slice(0,n),r=ze(e,t[n],o,i);if(r)return r}return null}(e,o.token.scopes,!1),a=r?.metadata?.foreground;if(s){if(a!==o.metadata.foreground){let e=De("code.tiw-theme-selector",void 0,s.rawSelector,De("br"),JSON.stringify(s.settings,null,"\t"));a&&(e=De("s",void 0,e)),(0,m.BC)(i,De("tr",void 0,De("td.tiw-metadata-key",void 0,"foreground"),De("td.tiw-metadata-value",void 0,e)))}}else a||(0,m.BC)(i,De("tr",void 0,De("td.tiw-metadata-key",void 0,"foreground"),De("td.tiw-metadata-value",void 0,"No theme selector")))}if(s){(0,m.BC)(this._domNode,De("hr.tiw-metadata-separator"));const e=(0,m.BC)(this._domNode,De("table.tiw-metadata-table")),t=(0,m.BC)(e,De("tbody"));(0,m.BC)(t,De("tr",void 0,De("td.tiw-metadata-key",void 0,"tree-sitter token"),De("td.tiw-metadata-value",void 0,`${s.text}`)));const i=new Array;let o=s;for(;o.parent;)i.push(o.type),o=o.parent,o&&i.push(De("br"));(0,m.BC)(t,De("tr",void 0,De("td.tiw-metadata-key",void 0,"tree-sitter scopes"),De("td.tiw-metadata-value.tiw-metadata-scopes",void 0,...i)));const r=C.OB.get(this._model.getLanguageId()),a=r?.captureAtPosition(n.lineNumber,n.column,this._model);a&&a.length>0&&(0,m.BC)(t,De("tr",void 0,De("td.tiw-metadata-key",void 0,"foreground"),De("td.tiw-metadata-value",void 0,a[a.length-1].name)))}}_formatMetadata(e,t){const i=new Array;function n(n){const o=e?.[n]||t?.[n];if(void 0!==o){const t=e?.[n]?"tiw-metadata-semantic":"";i.push(De("tr",void 0,De("td.tiw-metadata-key",void 0,n),De(`td.tiw-metadata-value.${t}`,void 0,o)))}return o}const o=n("foreground"),r=n("background");if(o&&r){const e=_.Q1.fromHex(r),t=_.Q1.fromHex(o);e.isOpaque()?i.push(De("tr",void 0,De("td.tiw-metadata-key",void 0,"contrast ratio"),De("td.tiw-metadata-value",void 0,e.getContrastRatio(t.makeOpaque(e)).toFixed(2)))):i.push(De("tr",void 0,De("td.tiw-metadata-key",void 0,"Contrast ratio cannot be precise for background colors that use transparency"),De("td.tiw-metadata-value")))}const s=new Array;function a(i){let n;e&&e[i]?n=De("span.tiw-metadata-semantic",void 0,i):t&&t[i]&&(n=i),n&&(s.length&&s.push(" "),s.push(n))}return a("bold"),a("italic"),a("underline"),a("strikethrough"),s.length&&i.push(De("tr",void 0,De("td.tiw-metadata-key",void 0,"font style"),De("td.tiw-metadata-value",void 0,...s))),i}_decodeMetadata(e){const t=this._themeService.getColorTheme().tokenColorMap,i=B.x.getLanguageId(e),n=B.x.getTokenType(e),o=B.x.getFontStyle(e),r=B.x.getForeground(e),s=B.x.getBackground(e);return{languageId:this._languageService.languageIdCodec.decodeLanguageId(i),tokenType:n,bold:!!(2&o)||void 0,italic:!!(1&o)||void 0,underline:!!(4&o)||void 0,strikethrough:!!(8&o)||void 0,foreground:t[r],background:t[s]}}_tokenTypeToString(e){switch(e){case 0:return"Other";case 1:return"Comment";case 2:return"String";case 3:return"RegEx";default:return"??"}}_getTokensAtPosition(e,t){const i=t.lineNumber,n=this._getStateBeforeLine(e,i),o=e.tokenizeLine(this._model.getLineContent(i),n),r=e.tokenizeLine2(this._model.getLineContent(i),n);let s=0;for(let e=o.tokens.length-1;e>=0;e--){const i=o.tokens[e];if(t.column-1>=i.startIndex){s=e;break}}let a=0;for(let e=r.tokens.length>>>1;e>=0;e--)if(t.column-1>=r.tokens[e<<1]){a=e;break}return{token:o.tokens[s],metadata:this._decodeMetadata(r.tokens[1+(a<<1)])}}_getStateBeforeLine(e,t){let i=null;for(let n=1;n<t;n++)i=e.tokenizeLine(this._model.getLineContent(n),i).ruleStack;return i}isSemanticTokens(e){return e&&e.data}async _computeSemanticTokens(e){if(!this._isSemanticColoringEnabled())return null;const t=this._languageFeaturesService.documentSemanticTokensProvider.ordered(this._model);if(t.length){const e=t[0],i=await Promise.resolve(e.provideDocumentSemanticTokens(this._model,null,this._currentRequestCancellationTokenSource.token));if(this.isSemanticTokens(i))return{tokens:i,legend:e.getLegend()}}const i=this._languageFeaturesService.documentRangeSemanticTokensProvider.ordered(this._model);if(i.length){const t=i[0],n=e.lineNumber,o=new H.Q(n,1,n,this._model.getLineMaxColumn(n)),r=await Promise.resolve(t.provideDocumentRangeSemanticTokens(this._model,o,this._currentRequestCancellationTokenSource.token));if(this.isSemanticTokens(r))return{tokens:r,legend:t.getLegend()}}return null}_getSemanticTokenAtPosition(e,t){const i=e.tokens.data,n=this._model.getLanguageId();let o=0,r=0;const s=t.lineNumber-1,a=t.column-1;for(let t=0;t<i.length;t+=5){const c=i[t],d=i[t+1],g=i[t+2],l=i[t+3],h=i[t+4],u=o+c,m=0===c?r+d:d;if(s===u&&m<=a&&a<m+g){const t=e.legend.tokenTypes[l]||"not in legend (ignored)",i=[];let o=h;for(let t=0;o>0&&t<e.legend.tokenModifiers.length;t++)1&o&&i.push(e.legend.tokenModifiers[t]),o>>=1;o>0&&i.push("not in legend (ignored)");const r=new H.Q(u+1,m+1,u+1,m+1+g),s={},a=this._themeService.getColorTheme().tokenColorMap,c=this._themeService.getColorTheme().getTokenStyleMetadata(t,i,n,!0,s);let d;return c&&(d={languageId:void 0,tokenType:0,bold:c?.bold,italic:c?.italic,underline:c?.underline,strikethrough:c?.strikethrough,foreground:a[c?.foreground||0],background:void 0}),{type:t,modifiers:i,range:r,metadata:d,definitions:s}}o=u,r=m}return null}_walkTreeforPosition(e,t){const i=this._model.getOffsetAt(t);e.gotoFirstChild();let n=!1,o=null;do{e.currentNode.startIndex<=i&&i<e.currentNode.endIndex?(n=!0,o=e.currentNode):n=!1}while(n?e.gotoFirstChild():e.gotoNextSibling());return o}_getTreeSitterTokenAtPosition(e,t){const i=e.walk();return this._walkTreeforPosition(i,t)}_renderTokenStyleDefinition(e,t){const i=new Array;if(void 0===e)return i;const n=this._themeService.getColorTheme();if(Array.isArray(e)){const o={};n.resolveScopes(e,o);const r=o[t];if(r&&o.scope){const e=De("ul.tiw-metadata-values"),t=Array.isArray(r.scope)?r.scope:[String(r.scope)];for(const i of t)e.appendChild(De("li.tiw-metadata-value.tiw-metadata-scopes",void 0,i));return i.push(o.scope.join(" "),e,De("code.tiw-theme-selector",void 0,JSON.stringify(r.settings,null,"\t"))),i}return i}if(ye.yS.is(e)){const o=n.getTokenStylingRuleScope(e);return"setting"===o?(i.push(`User settings: ${e.selector.id} - ${this._renderStyleProperty(e.style,t)}`),i):"theme"===o?(i.push(`Color theme: ${e.selector.id} - ${this._renderStyleProperty(e.style,t)}`),i):i}{const o=n.resolveTokenStyleValue(e);return i.push(`Default: ${o?this._renderStyleProperty(o,t):""}`),i}}_renderStyleProperty(e,t){return"foreground"===t?e.foreground?_.Q1.Format.CSS.formatHexA(e.foreground,!0):"":void 0!==e[t]?String(e[t]):""}getDomNode(){return this._domNode}getPosition(){return{position:this._editor.getPosition(),preference:[2,1]}}}(0,xe.HW)(Ae.ID,Ae,4),(0,xe.Fl)(je);const Re=new URL(i(24619),i.b).href;function Fe(){return{...(0,_e.Ay)(),[r.S.toString()]:new s.d(me,[],!1)}}(0,ke.B)({"vscode-oniguruma/../onig.wasm":Re,"vs/../../node_modules/vscode-oniguruma/release/onig.wasm":Re}),(0,fe.GP)((async e=>{e.get(pe.f).when(2).then((()=>{o.QE.get(r.S)}))}))}}]);