"use strict";(self.webpackChunkmonaco_lsp_streams=self.webpackChunkmonaco_lsp_streams||[]).push([[182],{1392:(e,t,i)=>{var r=i(92518),o=i(24821),s=i(53725),n=i(16849),d=i(12417),a=i(92449),c=i(71547),h=i(30875),u=i(96845),l=i(79367),p=i(47575);let g=class extends o.jG{static{this.ID="workbench.contrib.editorAutoSave"}constructor(e,t,i,r,s,n,d,a){super(),this.filesConfigurationService=e,this.hostService=t,this.editorService=i,this.editorGroupService=r,this.workingCopyService=s,this.logService=n,this.markerService=d,this.uriIdentityService=a,this.scheduledAutoSavesAfterDelay=new Map,this.lastActiveEditor=void 0,this.lastActiveGroupId=void 0,this.lastActiveEditorControlDisposable=this._register(new o.Cm),this.waitingOnConditionAutoSaveWorkingCopies=new l.fT((e=>this.uriIdentityService.extUri.getComparisonKey(e))),this.waitingOnConditionAutoSaveEditors=new l.fT((e=>this.uriIdentityService.extUri.getComparisonKey(e)));for(const e of this.workingCopyService.dirtyWorkingCopies)this.onDidRegister(e);this.registerListeners()}registerListeners(){this._register(this.hostService.onDidChangeFocus((e=>this.onWindowFocusChange(e)))),this._register(this.hostService.onDidChangeActiveWindow((()=>this.onActiveWindowChange()))),this._register(this.editorService.onDidActiveEditorChange((()=>this.onDidActiveEditorChange()))),this._register(this.filesConfigurationService.onDidChangeAutoSaveConfiguration((()=>this.onDidChangeAutoSaveConfiguration()))),this._register(this.workingCopyService.onDidRegister((e=>this.onDidRegister(e)))),this._register(this.workingCopyService.onDidUnregister((e=>this.onDidUnregister(e)))),this._register(this.workingCopyService.onDidChangeDirty((e=>this.onDidChangeDirty(e)))),this._register(this.workingCopyService.onDidChangeContent((e=>this.onDidChangeContent(e)))),this._register(this.markerService.onMarkerChanged((e=>this.onConditionChanged(e,3)))),this._register(this.filesConfigurationService.onDidChangeAutoSaveDisabled((e=>this.onConditionChanged([e],4))))}onConditionChanged(e,t){for(const i of e){const e=this.waitingOnConditionAutoSaveWorkingCopies.get(i);if(e?.condition===t)e.workingCopy.isDirty()&&0!==this.filesConfigurationService.getAutoSaveMode(e.workingCopy.resource,e.reason).mode&&(this.discardAutoSave(e.workingCopy),this.logService.trace("[editor auto save] running auto save from condition change event",e.workingCopy.resource.toString(),e.workingCopy.typeId),e.workingCopy.save({reason:e.reason}));else{const e=this.waitingOnConditionAutoSaveEditors.get(i);e?.condition===t&&!e.editor.editor.isDisposed()&&e.editor.editor.isDirty()&&0!==this.filesConfigurationService.getAutoSaveMode(e.editor.editor,e.reason).mode&&(this.waitingOnConditionAutoSaveEditors.delete(i),this.logService.trace(`[editor auto save] running auto save from condition change event with reason ${e.reason}`),this.editorService.save(e.editor,{reason:e.reason}))}}}onWindowFocusChange(e){e||this.maybeTriggerAutoSave(4)}onActiveWindowChange(){this.maybeTriggerAutoSave(4)}onDidActiveEditorChange(){this.lastActiveEditor&&"number"==typeof this.lastActiveGroupId&&this.maybeTriggerAutoSave(3,{groupId:this.lastActiveGroupId,editor:this.lastActiveEditor});const e=this.editorGroupService.activeGroup,t=this.lastActiveEditor=e.activeEditor??void 0;this.lastActiveGroupId=e.id,this.lastActiveEditorControlDisposable.clear();const i=this.editorService.activeEditorPane;t&&i&&this.lastActiveEditorControlDisposable.add(i.onDidBlur((()=>{this.maybeTriggerAutoSave(3,{groupId:e.id,editor:t})})))}maybeTriggerAutoSave(e,t){if(t){if(!t.editor.isDirty()||t.editor.isReadonly()||t.editor.hasCapability(4))return;const i=this.filesConfigurationService.getAutoSaveMode(t.editor,e);0!==i.mode?(4===e&&(3===i.mode||4===i.mode)||3===e&&3===i.mode)&&(this.logService.trace(`[editor auto save] triggering auto save with reason ${e}`),this.editorService.save(t,{reason:e})):!t.editor.resource||3!==i.reason&&4!==i.reason||this.waitingOnConditionAutoSaveEditors.set(t.editor.resource,{editor:t,reason:e,condition:i.reason})}else this.saveAllDirtyAutoSaveables(e)}onDidChangeAutoSaveConfiguration(){let e;switch(this.filesConfigurationService.getAutoSaveMode(void 0).mode){case 3:e=3;break;case 4:e=4;break;case 1:case 2:e=2}e&&this.saveAllDirtyAutoSaveables(e)}saveAllDirtyAutoSaveables(e){for(const t of this.workingCopyService.dirtyWorkingCopies){if(2&t.capabilities)continue;const i=this.filesConfigurationService.getAutoSaveMode(t.resource,e);0!==i.mode?t.save({reason:e}):3!==i.reason&&4!==i.reason||this.waitingOnConditionAutoSaveWorkingCopies.set(t.resource,{workingCopy:t,reason:e,condition:i.reason})}}onDidRegister(e){e.isDirty()&&this.scheduleAutoSave(e)}onDidUnregister(e){this.discardAutoSave(e)}onDidChangeDirty(e){e.isDirty()?this.scheduleAutoSave(e):this.discardAutoSave(e)}onDidChangeContent(e){e.isDirty()&&this.scheduleAutoSave(e)}scheduleAutoSave(e){if(2&e.capabilities)return;const t=this.filesConfigurationService.getAutoSaveConfiguration(e.resource).autoSaveDelay;if("number"!=typeof t)return;this.discardAutoSave(e),this.logService.trace(`[editor auto save] scheduling auto save after ${t}ms`,e.resource.toString(),e.typeId);const i=setTimeout((()=>{if(this.discardAutoSave(e),e.isDirty()){const t=2,i=this.filesConfigurationService.getAutoSaveMode(e.resource,t);0!==i.mode?(this.logService.trace("[editor auto save] running auto save",e.resource.toString(),e.typeId),e.save({reason:t})):3!==i.reason&&4!==i.reason||this.waitingOnConditionAutoSaveWorkingCopies.set(e.resource,{workingCopy:e,reason:t,condition:i.reason})}}),t);this.scheduledAutoSavesAfterDelay.set(e,(0,o.s)((()=>{this.logService.trace("[editor auto save] clearing pending auto save",e.resource.toString(),e.typeId),clearTimeout(i)})))}discardAutoSave(e){(0,o.AS)(this.scheduledAutoSavesAfterDelay.get(e)),this.scheduledAutoSavesAfterDelay.delete(e),this.waitingOnConditionAutoSaveWorkingCopies.delete(e.resource),this.waitingOnConditionAutoSaveEditors.delete(e.resource)}};g=(0,r.C)([(0,r.Q)(0,s.U),(0,r.Q)(1,n.v),(0,r.Q)(2,d.I),(0,r.Q)(3,a.m),(0,r.Q)(4,c.v),(0,r.Q)(5,h.r),(0,r.Q)(6,u.D),(0,r.Q)(7,p.J)],g),(0,i(87866).tr)(g.ID,g,2)},55722:(e,t,i)=>{i.d(t,{k:()=>d});var r=i(92518),o=i(59981),s=i(96485),n=i(93913);let d=class extends o.V{constructor(e,t,i){super(),this.resource=e,this.name=t,this.fileService=i,this.mime=n.KV.binary}getName(){return this.name}getSize(){return this.size}getMime(){return this.mime}getETag(){return this.etag}async resolve(){if(this.fileService.hasProvider(this.resource)){const e=await this.fileService.stat(this.resource);this.etag=e.etag,"number"==typeof e.size&&(this.size=e.size)}return super.resolve()}};d=(0,r.C)([(0,r.Q)(2,s.$)],d)},52606:(e,t,i)=>{i.d(t,{K:()=>w});var r,o=i(92518),s=i(80512),n=i(865),d=i(55722),a=i(96485),c=i(89519),h=i(28672),u=i(24821),l=i(45259),p=i(39320),g=i(1935),v=i(53725),f=i(12417),E=i(85412),m=i(1661),C=i(30787),S=i(86472),y=i(65693),D=i(13901),A=i(59496);let w=r=class extends n.f{get typeId(){return p.Io}get editorId(){return s.Ie.id}get capabilities(){let e=32;return this.model?this.model.isReadonly()&&(e|=2):this.fileService.hasProvider(this.resource)?this.filesConfigurationService.isReadonly(this.resource)&&(e|=2):e|=4,2&e||(e|=128),e}constructor(e,t,i,r,o,s,n,d,a,c,h,l,p,g,v,f,E){super(e,t,g,a,h,l,p,f,E),this.instantiationService=d,this.textModelService=c,this.pathService=v,this.forceOpenAs=0,this.model=void 0,this.cachedTextFileModelReference=void 0,this.modelListeners=this._register(new u.Cm),this.model=this.textFileService.files.get(e),i&&this.setPreferredName(i),r&&this.setPreferredDescription(r),o&&this.setPreferredEncoding(o),s&&this.setPreferredLanguageId(s),"string"==typeof n&&this.setPreferredContents(n),this._register(this.textFileService.files.onDidCreate((e=>this.onDidCreateTextFileModel(e)))),this.model&&this.registerModelListeners(this.model)}onDidCreateTextFileModel(e){(0,E.n4)(e.resource,this.resource)&&(this.model=e,this.registerModelListeners(e))}registerModelListeners(e){this.modelListeners.clear(),this.modelListeners.add(e.onDidChangeDirty((()=>this._onDidChangeDirty.fire()))),this.modelListeners.add(e.onDidChangeReadonly((()=>this._onDidChangeCapabilities.fire()))),this.modelListeners.add(e.onDidSaveError((()=>this._onDidChangeDirty.fire()))),this.modelListeners.add(m.Jh.once(e.onWillDispose)((()=>{this.modelListeners.clear(),this.model=void 0})))}getName(){return this.preferredName||super.getName()}setPreferredName(e){this.allowLabelOverride()&&this.preferredName!==e&&(this.preferredName=e,this._onDidChangeLabel.fire())}allowLabelOverride(){return this.resource.scheme!==this.pathService.defaultUriScheme&&this.resource.scheme!==C.ny.vscodeUserData&&this.resource.scheme!==C.ny.file&&this.resource.scheme!==C.ny.vscodeRemote}getPreferredName(){return this.preferredName}isReadonly(){return this.model?this.model.isReadonly():this.filesConfigurationService.isReadonly(this.resource)}getDescription(e){return this.preferredDescription||super.getDescription(e)}setPreferredDescription(e){this.allowLabelOverride()&&this.preferredDescription!==e&&(this.preferredDescription=e,this._onDidChangeLabel.fire())}getPreferredDescription(){return this.preferredDescription}getTitle(e){let t=super.getTitle(e);const i=this.getPreferredTitle();return i&&(t=`${i} (${t})`),t}getPreferredTitle(){return this.preferredName&&this.preferredDescription?`${this.preferredName} ${this.preferredDescription}`:this.preferredName||this.preferredDescription?this.preferredName??this.preferredDescription:void 0}getEncoding(){return this.model?this.model.getEncoding():this.preferredEncoding}getPreferredEncoding(){return this.preferredEncoding}async setEncoding(e,t){return this.setPreferredEncoding(e),this.model?.setEncoding(e,t)}setPreferredEncoding(e){this.preferredEncoding=e,this.setForceOpenAsText()}getLanguageId(){return this.model?this.model.getLanguageId():this.preferredLanguageId}getPreferredLanguageId(){return this.preferredLanguageId}setLanguageId(e,t){this.setPreferredLanguageId(e),this.model?.setLanguageId(e,t)}setPreferredLanguageId(e){this.preferredLanguageId=e,this.setForceOpenAsText()}setPreferredContents(e){this.preferredContents=e,this.setForceOpenAsText()}setForceOpenAsText(){this.forceOpenAs=1}setForceOpenAsBinary(){this.forceOpenAs=2}isDirty(){return!!this.model?.isDirty()}isSaving(){return!(this.model?.hasState(0)||this.model?.hasState(3)||this.model?.hasState(5))&&(!!this.filesConfigurationService.hasShortAutoSaveDelay(this)||super.isSaving())}prefersEditorPane(e){return 2===this.forceOpenAs?e.find((e=>e.typeId===p.H6)):e.find((e=>e.typeId===p.hS))}resolve(e){return 2===this.forceOpenAs?this.doResolveAsBinary():this.doResolveAsText(e)}async doResolveAsText(e){try{const t=this.preferredContents;this.preferredContents=void 0,await this.textFileService.files.resolve(this.resource,{languageId:this.preferredLanguageId,encoding:this.preferredEncoding,contents:"string"==typeof t?(0,S.q3)(t):void 0,reload:{async:!0},allowBinary:1===this.forceOpenAs,reason:1,limits:this.ensureLimits(e)}),this.cachedTextFileModelReference||(this.cachedTextFileModelReference=await this.textModelService.createModelReference(this.resource));const i=this.cachedTextFileModelReference.object;return this.isDisposed()&&this.disposeModelReference(),i}catch(e){if(0===e.textFileOperationResult)return this.doResolveAsBinary();throw e}}async doResolveAsBinary(){const e=this.instantiationService.createInstance(d.k,this.preferredResource,this.getName());return await e.resolve(),e}isResolved(){return!!this.model}async rename(e,t){return{editor:{resource:t,encoding:this.getEncoding(),options:{viewState:(0,s.su)(this,e,this.editorService)}}}}toUntyped(e){const t={resource:this.preferredResource,forceFile:!0,options:{override:this.editorId}};return"number"==typeof e?.preserveViewState&&(t.encoding=this.getEncoding(),t.languageId=this.getLanguageId(),t.contents=(()=>{const e=this.textFileService.files.get(this.resource);if(e?.isDirty()&&!e.textEditorModel.isTooLargeForHeapOperation())return e.textEditorModel.getValue()})(),t.options={...t.options,viewState:(0,s.su)(this,e.preserveViewState,this.editorService)}),t}matches(e){return this===e||(e instanceof r?(0,E.n4)(e.resource,this.resource):!!(0,s.iY)(e)&&super.matches(e))}dispose(){this.model=void 0,this.disposeModelReference(),super.dispose()}disposeModelReference(){(0,u.AS)(this.cachedTextFileModelReference),this.cachedTextFileModelReference=void 0}};w=r=(0,o.C)([(0,o.Q)(7,h._Y),(0,o.Q)(8,c.a),(0,o.Q)(9,l.b),(0,o.Q)(10,g.L),(0,o.Q)(11,a.$),(0,o.Q)(12,v.U),(0,o.Q)(13,f.I),(0,o.Q)(14,y.S),(0,o.Q)(15,D.U),(0,o.Q)(16,A.p)],w)},24168:(e,t,i)=>{var r=i(25934),o=i(80512),s=i(23703),n=i(28672),d=i(69612),a=i(50928),c=i(77512),h=i(61478),u=(i(19871),i(21747)),l=i(39320),p=i(36220),g=(i(96473),i(87427)),v=(i(13064),i(68836));function f(e){const t=e.get(u.P).lastFocusedList,i=t?.getHTMLElement();if(i&&(0,v.X7)(i)&&t instanceof p.B8){const e=(0,g.Yc)(t.getSelectedElements().filter((e=>e instanceof l.Ej))),i=t.getFocusedElements(),r=i.length?i[0]:void 0;let o;return r instanceof l.Ej&&(o=r),e.some((e=>e===o))?e:o?[o]:void 0}}var E=i(47609),m=(i(92372),i(54521)),C=i(12417),S=i(92449),y=i(85412),D=i(30846),A=i(35218),w=i(89519),I=i(53658),R=i(76390),G=i(37653),b=i(58349),O=i(32834);async function M(e,t){const i=e.get(S.m),r=e.get(D.T),n=e.get(w.a);let d=f(e);if(!d){const e=i.activeGroup;e.activeEditor&&(d=[],e.activeEditor instanceof s.JL&&!t?.saveAs&&!e.activeEditor.primary.hasCapability(4)&&!e.activeEditor.secondary.hasCapability(4)&&e.activeEditor.secondary.isModified()?(d.push({groupId:e.id,editor:e.activeEditor.primary}),d.push({groupId:e.id,editor:e.activeEditor.secondary})):d.push({groupId:e.id,editor:e.activeEditor}))}if(!d||0===d.length)return;await k(e,d,t);const a=r.getFocusedCodeEditor();if(a instanceof A.t&&!a.isSimpleWidget){const e=a.getModel()?.uri;if(e&&!d.some((({editor:t})=>(0,y.n4)(o.tf.getCanonicalUri(t,{supportSideBySide:o.zX.PRIMARY}),e)))){const i=n.files.get(e);i?.isReadonly()||await n.save(e,t)}}}function x(e,t,i){const r=[];for(const e of t)for(const t of e.getEditors(0))t.isDirty()&&r.push({groupId:e.id,editor:t});return k(e,r,i)}async function k(e,t,i){const o=e.get(C.I),s=e.get(m.O),a=e.get(n._Y);try{await o.save(t,i)}catch(e){if(!(0,I.MB)(e)){const n=[(0,R.ih)({id:"workbench.action.files.saveEditors",label:(0,r.kg)(3263,"Retry"),run:()=>a.invokeFunction((e=>k(e,t,i)))})],c=t.filter((({editor:e})=>!e.hasCapability(4)));c.length>0&&n.push((0,R.ih)({id:"workbench.action.files.revertEditors",label:c.length>1?(0,r.kg)(3264,"Revert All"):(0,r.kg)(3265,"Revert"),run:()=>o.revert(c)})),s.notify({id:t.map((({editor:e})=>(0,G.tW)(e.resource?.toString()))).join(),severity:O.A.Error,message:(0,r.kg)(3266,"Failed to save '{0}': {1}",t.map((({editor:e})=>e.getName())).join(", "),(0,d.rx)(e,!1)),actions:{primary:n}})}}}c.f.registerCommandAndKeybindingRule({when:void 0,weight:200,primary:2097,id:b.Nh,handler:e=>M(e,{reason:1,force:!0})}),c.f.registerCommandAndKeybindingRule({when:void 0,weight:200,primary:(0,h.m5)(2089,49),win:{primary:(0,h.m5)(2089,3121)},id:b.aq,handler:e=>M(e,{reason:1,force:!0,skipSaveParticipants:!0})}),c.f.registerCommandAndKeybindingRule({id:b.Us,weight:200,when:void 0,primary:3121,handler:e=>M(e,{reason:1,saveAs:!0})}),c.f.registerCommandAndKeybindingRule({when:void 0,weight:200,primary:void 0,mac:{primary:2609},win:{primary:(0,h.m5)(2089,49)},id:b.gw,handler:e=>x(e,e.get(S.m).getGroups(1),{reason:1})}),a.w.registerCommand({id:b.q8,handler:(e,t,i)=>{const r=e.get(S.m),o=(0,E.w)([i],e.get(C.I),r,e.get(u.P));let s;return s=o.groupedEditors.length?o.groupedEditors.map((({group:e})=>e)):r.getGroups(1),x(e,s,{reason:1})}}),a.w.registerCommand({id:b.wG,handler:async e=>{const t=e.get(C.I);return(await t.saveAll({includeUntitled:!1,reason:1})).success}}),a.w.registerCommand({id:b.qY,handler:async e=>{const t=e.get(S.m),i=e.get(C.I);let o=f(e);if(!o){const e=t.activeGroup;e.activeEditor&&(o=[{groupId:e.id,editor:e.activeEditor}])}if(o&&0!==o.length)try{await i.revert(o.filter((({editor:e})=>!e.hasCapability(4))),{force:!0})}catch(t){e.get(m.O).error((0,r.kg)(3267,"Failed to revert '{0}': {1}",o.map((({editor:e})=>e.getName())).join(", "),(0,d.rx)(t,!1)))}}})},89887:(e,t,i)=>{var r=i(93152),o=i(80512),s=i(52606),n=i(39320);r.O.as(o.q5.EditorFactory).registerFileEditorFactory({typeId:n.Io,createFileEditor:(e,t,i,r,o,n,d,a)=>a.createInstance(s.K,e,t,i,r,o,n,d),isFileEditor:e=>e instanceof s.K})},95560:(e,t,i)=>{i.d(t,{g:()=>l});var r=i(92518),o=i(34559),s=i(27652),n=i(40240),d=i(68796),a=i(12417),c=(i(28672),i(85412)),h=i(819),u=i(5310);let l=class extends s.CL{constructor(e,t,i){super(t),this.editorService=e,this.configurationService=i,this._register(this.registerCodeEditorOpenHandler(this.doOpenCodeEditor.bind(this))),this._register(this.registerCodeEditorOpenHandler(this.doOpenCodeEditorFromDiff.bind(this)))}getActiveCodeEditor(){const e=this.editorService.activeTextEditorControl;if((0,o.z9)(e))return e;if((0,o.Np)(e))return e.getModifiedEditor();const t=this.editorService.activeEditorPane?.getControl();return(0,o.Pf)(t)&&(0,o.z9)(t.activeCodeEditor)?t.activeCodeEditor:null}async doOpenCodeEditorFromDiff(e,t,i){const r=this.editorService.activeTextEditorControl;if(!i&&(0,o.Np)(r)&&e.options&&e.resource&&t===r.getModifiedEditor()&&r.getModel()&&(0,c.n4)(e.resource,r.getModel()?.modified.uri)){const t=r.getModifiedEditor();return(0,u.r)(e.options,t,0),t}return null}async doOpenCodeEditor(e,t,i){const r=this.configurationService.getValue().workbench?.editor?.enablePreviewFromCodeNavigation;if(!r&&t&&!e.options?.pinned&&!i&&!(0,c.n4)(t.getModel()?.uri,e.resource))for(const e of this.editorService.visibleEditorPanes)if((0,o.jA)(e.getControl())===t){e.group.pinEditor();break}const s=await this.editorService.openEditor(e,i?d.Sd:d.Bn);if(s){const e=s.getControl();if((0,o.z9)(e))return e;if((0,o.Pf)(e)&&(0,o.z9)(e.activeCodeEditor))return e.activeCodeEditor}return null}};l=(0,r.C)([(0,r.Q)(0,a.I),(0,r.Q)(1,n.G),(0,r.Q)(2,h.p)],l)},65669:(e,t,i)=>{i.d(t,{x:()=>Q});var r,o=i(92518),s=i(28672),n=i(80512),d=i(15904),a=i(23703),c=i(79367),h=i(94384),u=i(96485),l=i(1661),p=i(19871),g=i(85412),v=i(65965),f=i(15778),E=i(20092),m=i(92449),C=i(68796),S=i(819),y=i(24821),D=i(87427),A=i(34559),w=i(1180),I=i(64533),R=i(93152),G=i(42317);let b=class extends y.jG{static{r=this}static{this.STORAGE_KEY="editors.mru"}get count(){return this.mostRecentEditorsMap.size}get editors(){return[...this.mostRecentEditorsMap.values()]}hasEditor(e){const t=this.editorsPerResourceCounter.get(e.resource);return t?.has(this.toIdentifier(e))??!1}hasEditors(e){return this.editorsPerResourceCounter.has(e)}toIdentifier(e,t){return"string"!=typeof e?this.toIdentifier(e.typeId,e.editorId):t?`${e}/${t}`:e}constructor(e,t,i){super(),this.editorGroupService=t,this.storageService=i,this.keyMap=new Map,this.mostRecentEditorsMap=new c.I4,this.editorsPerResourceCounter=new c.fT,this._onDidMostRecentlyActiveEditorsChange=this._register(new l.vl),this.onDidMostRecentlyActiveEditorsChange=this._onDidMostRecentlyActiveEditorsChange.event,this.editorGroupsContainer=e??t,this.isScoped=!!e,this.registerListeners(),this.loadState()}registerListeners(){this._register(this.editorGroupsContainer.onDidAddGroup((e=>this.onGroupAdded(e)))),this._register(this.editorGroupService.onDidChangeEditorPartOptions((e=>this.onDidChangeEditorPartOptions(e)))),this._register(this.storageService.onWillSaveState((()=>this.saveState())))}onGroupAdded(e){const t=e.getEditors(0);for(let i=t.length-1;i>=0;i--)this.addMostRecentEditor(e,t[i],!1,!0);this.editorGroupsContainer.activeGroup===e&&e.activeEditor&&this.addMostRecentEditor(e,e.activeEditor,!0,!1),this.registerGroupListeners(e)}registerGroupListeners(e){const t=new y.Cm;t.add(e.onDidModelChange((t=>{switch(t.kind){case 0:this.editorGroupsContainer.activeGroup===e&&e.activeEditor&&this.addMostRecentEditor(e,e.activeEditor,!0,!1);break;case 5:t.editor&&(this.addMostRecentEditor(e,t.editor,!1,!0),this.ensureOpenedEditorsLimit({groupId:e.id,editor:t.editor},e.id))}}))),t.add(e.onDidCloseEditor((t=>{this.removeMostRecentEditor(e,t.editor)}))),t.add(e.onDidActiveEditorChange((t=>{t.editor&&this.addMostRecentEditor(e,t.editor,this.editorGroupsContainer.activeGroup===e,!1)}))),l.Jh.once(e.onWillDispose)((()=>(0,y.AS)(t)))}onDidChangeEditorPartOptions(e){if(!(0,G.aI)(e.newPartOptions.limit,e.oldPartOptions.limit)){const e=this.editorGroupsContainer.activeGroup;let t;e.activeEditor&&(t={editor:e.activeEditor,groupId:e.id}),this.ensureOpenedEditorsLimit(t)}}addMostRecentEditor(e,t,i,r){const o=this.ensureKey(e,t),s=this.mostRecentEditorsMap.first;i||!s?this.mostRecentEditorsMap.set(o,o,s?1:void 0):(this.mostRecentEditorsMap.set(o,o,1),this.mostRecentEditorsMap.set(s,s,1)),r&&this.updateEditorResourcesMap(t,!0),this._onDidMostRecentlyActiveEditorsChange.fire()}updateEditorResourcesMap(e,t){let i,r,o;if(e instanceof a.JL?(i=e.primary.resource,r=e.primary.typeId,o=e.primary.editorId):(i=e.resource,r=e.typeId,o=e.editorId),!i)return;const s=this.toIdentifier(r,o);if(t){let e=this.editorsPerResourceCounter.get(i);e||(e=new Map,this.editorsPerResourceCounter.set(i,e)),e.set(s,(e.get(s)??0)+1)}else{const e=this.editorsPerResourceCounter.get(i);if(e){const t=e.get(s)??0;t>1?e.set(s,t-1):(e.delete(s),0===e.size&&this.editorsPerResourceCounter.delete(i))}}}removeMostRecentEditor(e,t){this.updateEditorResourcesMap(t,!1);const i=this.findKey(e,t);if(i){this.mostRecentEditorsMap.delete(i);const t=this.keyMap.get(e.id);t&&t.delete(i.editor)&&0===t.size&&this.keyMap.delete(e.id),this._onDidMostRecentlyActiveEditorsChange.fire()}}findKey(e,t){const i=this.keyMap.get(e.id);if(i)return i.get(t)}ensureKey(e,t){let i=this.keyMap.get(e.id);i||(i=new Map,this.keyMap.set(e.id,i));let r=i.get(t);return r||(r={groupId:e.id,editor:t},i.set(t,r)),r}async ensureOpenedEditorsLimit(e,t){if(!this.editorGroupService.partOptions.limit?.enabled||"number"!=typeof this.editorGroupService.partOptions.limit.value||this.editorGroupService.partOptions.limit.value<=0)return;const i=this.editorGroupService.partOptions.limit.value;if(this.editorGroupService.partOptions.limit?.perEditorGroup)if("number"==typeof t){const r=this.editorGroupsContainer.getGroup(t);r&&await this.doEnsureOpenedEditorsLimit(i,r.getEditors(0).map((e=>({editor:e,groupId:t}))),e)}else for(const t of this.editorGroupsContainer.groups)await this.ensureOpenedEditorsLimit(e,t.id);else await this.doEnsureOpenedEditorsLimit(i,[...this.mostRecentEditorsMap.values()],e)}async doEnsureOpenedEditorsLimit(e,t,i){let r;if(r=this.editorGroupService.partOptions.limit?.excludeDirty?t.filter((({editor:e})=>!(e.isDirty()&&!e.isSaving()||e.hasCapability(512)))):t,e>=r.length)return;const o=r.reverse().filter((({editor:e,groupId:t})=>!(e.isDirty()&&!e.isSaving()||e.hasCapability(512)||i&&e===i.editor&&t===i.groupId||this.editorGroupsContainer.getGroup(t)?.isSticky(e))));let s=r.length-e;const n=new Map;for(const{groupId:e,editor:t}of o){let i=n.get(e);if(i||(i=[],n.set(e,i)),i.push(t),s--,0===s)break}for(const[e,t]of n){const i=this.editorGroupsContainer.getGroup(e);i&&await i.closeEditors(t,{preserveFocus:!0})}}saveState(){this.isScoped||(this.mostRecentEditorsMap.isEmpty()?this.storageService.remove(r.STORAGE_KEY,1):this.storageService.store(r.STORAGE_KEY,JSON.stringify(this.serialize()),1,1))}serialize(){const e=R.O.as(n.q5.EditorFactory),t=[...this.mostRecentEditorsMap.values()],i=new Map;return{entries:(0,D.Yc)(t.map((({editor:t,groupId:r})=>{const o=this.editorGroupsContainer.getGroup(r);if(!o)return;let s=i.get(o);s||(s=o.getEditors(1).filter((t=>{const i=e.getEditorSerializer(t);return i?.canSerialize(t)})),i.set(o,s));const n=s.indexOf(t);return-1!==n?{groupId:r,index:n}:void 0})))}}async loadState(){this.editorGroupsContainer!==this.editorGroupService.mainPart&&this.editorGroupsContainer!==this.editorGroupService||await this.editorGroupService.whenReady;let e=!1;if(!this.isScoped){const t=this.storageService.get(r.STORAGE_KEY,1);t&&(e=!0,this.deserialize(JSON.parse(t)))}if(!e){const e=this.editorGroupsContainer.getGroups(1);for(let t=e.length-1;t>=0;t--){const i=e[t],r=i.getEditors(0);for(let e=r.length-1;e>=0;e--)this.addMostRecentEditor(i,r[e],!0,!0)}}for(const e of this.editorGroupsContainer.groups)this.registerGroupListeners(e)}deserialize(e){const t=[];for(const{groupId:i,index:r}of e.entries){const e=this.editorGroupsContainer.getGroup(i);if(!e)continue;const o=e.getEditorByIndex(r);if(!o)continue;const s=this.ensureKey(e,o);t.push([s,s]),this.updateEditorResourcesMap(o,!0)}this.mostRecentEditorsMap.fromJSON(t)}};b=r=(0,o.C)([(0,o.Q)(1,m.m),(0,o.Q)(2,I.C)],b);var O,M=i(93765),x=i(77829),k=i(39385),P=i(47575),_=i(19383),F=i(2481),T=i(16849),L=i(26888),U=i(97008);let Q=O=class extends y.jG{constructor(e,t,i,r,o,s,n,d,a,h,u){super(),this.editorGroupService=t,this.instantiationService=i,this.fileService=r,this.configurationService=o,this.contextService=s,this.uriIdentityService=n,this.editorResolverService=d,this.workspaceTrustRequestService=a,this.hostService=h,this.textEditorService=u,this._onDidActiveEditorChange=this._register(new l.vl),this.onDidActiveEditorChange=this._onDidActiveEditorChange.event,this._onDidVisibleEditorsChange=this._register(new l.vl),this.onDidVisibleEditorsChange=this._onDidVisibleEditorsChange.event,this._onDidEditorsChange=this._register(new l.vl),this.onDidEditorsChange=this._onDidEditorsChange.event,this._onWillOpenEditor=this._register(new l.vl),this.onWillOpenEditor=this._onWillOpenEditor.event,this._onDidCloseEditor=this._register(new l.vl),this.onDidCloseEditor=this._onDidCloseEditor.event,this._onDidOpenEditorFail=this._register(new l.vl),this.onDidOpenEditorFail=this._onDidOpenEditorFail.event,this._onDidMostRecentlyActiveEditorsChange=this._register(new l.vl),this.onDidMostRecentlyActiveEditorsChange=this._onDidMostRecentlyActiveEditorsChange.event,this.lastActiveEditor=void 0,this.activeOutOfWorkspaceWatchers=new c.fT,this.closeOnFileDelete=!1,this.editorGroupsContainer=e??t,this.editorsObserver=this._register(this.instantiationService.createInstance(b,this.editorGroupsContainer)),this.onConfigurationUpdated(),this.registerListeners()}createScoped(e,t){return t.add(new O("main"===e?this.editorGroupService.mainPart:e,this.editorGroupService,this.instantiationService,this.fileService,this.configurationService,this.contextService,this.uriIdentityService,this.editorResolverService,this.workspaceTrustRequestService,this.hostService,this.textEditorService))}registerListeners(){this.editorGroupsContainer===this.editorGroupService.mainPart||this.editorGroupsContainer===this.editorGroupService?this.editorGroupService.whenReady.then((()=>this.onEditorGroupsReady())):this.onEditorGroupsReady(),this._register(this.editorGroupsContainer.onDidChangeActiveGroup((e=>this.handleActiveEditorChange(e)))),this._register(this.editorGroupsContainer.onDidAddGroup((e=>this.registerGroupListeners(e)))),this._register(this.editorsObserver.onDidMostRecentlyActiveEditorsChange((()=>this._onDidMostRecentlyActiveEditorsChange.fire()))),this._register(this.onDidVisibleEditorsChange((()=>this.handleVisibleEditorsChange()))),this._register(this.fileService.onDidRunOperation((e=>this.onDidRunFileOperation(e)))),this._register(this.fileService.onDidFilesChange((e=>this.onDidFilesChange(e)))),this._register(this.configurationService.onDidChangeConfiguration((e=>this.onConfigurationUpdated(e))))}onEditorGroupsReady(){for(const e of this.editorGroupsContainer.groups)this.registerGroupListeners(e);this.activeEditor&&(this.doHandleActiveEditorChangeEvent(),this._onDidVisibleEditorsChange.fire())}handleActiveEditorChange(e){e===this.editorGroupsContainer.activeGroup&&(this.lastActiveEditor||e.activeEditor)&&this.doHandleActiveEditorChangeEvent()}doHandleActiveEditorChangeEvent(){const e=this.editorGroupsContainer.activeGroup;this.lastActiveEditor=e.activeEditor??void 0,this._onDidActiveEditorChange.fire()}registerGroupListeners(e){const t=new y.Cm;t.add(e.onDidModelChange((t=>{this._onDidEditorsChange.fire({groupId:e.id,event:t})}))),t.add(e.onDidActiveEditorChange((()=>{this.handleActiveEditorChange(e),this._onDidVisibleEditorsChange.fire()}))),t.add(e.onWillOpenEditor((e=>{this._onWillOpenEditor.fire(e)}))),t.add(e.onDidCloseEditor((e=>{this._onDidCloseEditor.fire(e)}))),t.add(e.onDidOpenEditorFail((t=>{this._onDidOpenEditorFail.fire({editor:t,groupId:e.id})}))),l.Jh.once(e.onWillDispose)((()=>{(0,y.AS)(t)}))}handleVisibleEditorsChange(){const e=new c.rm;for(const t of this.visibleEditors){const i=(0,D.dM)((0,D.Yc)([n.tf.getCanonicalUri(t,{supportSideBySide:n.zX.PRIMARY}),n.tf.getCanonicalUri(t,{supportSideBySide:n.zX.SECONDARY})]),(e=>e.toString()));for(const t of i)this.fileService.hasProvider(t)&&!this.contextService.isInsideWorkspace(t)&&e.add(t)}for(const t of this.activeOutOfWorkspaceWatchers.keys())e.has(t)||((0,y.AS)(this.activeOutOfWorkspaceWatchers.get(t)),this.activeOutOfWorkspaceWatchers.delete(t));for(const t of e.keys())if(!this.activeOutOfWorkspaceWatchers.get(t)){const e=this.fileService.watch(t);this.activeOutOfWorkspaceWatchers.set(t,e)}}async onDidRunFileOperation(e){e.isOperation(2)&&this.handleMovedFile(e.resource,e.target.resource),(e.isOperation(1)||e.isOperation(2))&&this.handleDeletedFile(e.resource,!1,e.target?e.target.resource:void 0)}onDidFilesChange(e){e.gotDeleted()&&this.handleDeletedFile(e,!0)}async handleMovedFile(e,t){for(const i of this.editorGroupsContainer.groups){const r=[];for(const o of i.editors){const s=o.resource;if(!s||!this.uriIdentityService.extUri.isEqualOrParent(s,e))continue;let d;if(this.uriIdentityService.extUri.isEqual(e,s))d=t;else{const i=(0,k.p4)(s.path,e.path,this.uriIdentityService.extUri.ignorePathCasing(s));d=(0,g.uJ)(t,s.path.substr(i+e.path.length+1))}const a=await o.rename(i.id,d);if(!a)return;const c={preserveFocus:!0,pinned:i.isPinned(o),sticky:i.isSticky(o),index:i.getIndexOfEditor(o),inactive:!i.isActive(o)};(0,n.ct)(a.editor)?r.push({editor:o,replacement:a.editor,options:{...a.options,...c}}):r.push({editor:o,replacement:{...a.editor,options:{...a.editor.options,...c}}})}r.length&&this.replaceEditors(r,i)}}onConfigurationUpdated(e){if(e&&!e.affectsConfiguration("workbench.editor.closeOnFileDelete"))return;const t=this.configurationService.getValue();"boolean"==typeof t.workbench?.editor?.closeOnFileDelete?this.closeOnFileDelete=t.workbench.editor.closeOnFileDelete:this.closeOnFileDelete=!1}handleDeletedFile(e,t,i){for(const r of this.getAllNonDirtyEditors({includeUntitled:!1,supportSideBySide:!0}))(async()=>{const o=r.resource;if(o&&(this.closeOnFileDelete||!t)){if(i&&this.uriIdentityService.extUri.isEqualOrParent(o,i))return;let s=!1;if(s=e instanceof h.Qt?e.contains(o,2):this.uriIdentityService.extUri.isEqualOrParent(o,e),!s)return;let n=!1;t&&this.fileService.hasProvider(o)&&(await(0,M.wR)(100),n=await this.fileService.exists(o)),n||r.isDisposed()||r.dispose()}})()}getAllNonDirtyEditors(e){const t=[];function i(i){i.hasCapability(4)&&!e.includeUntitled||i.isDirty()||t.push(i)}for(const t of this.editors)e.supportSideBySide&&t instanceof a.JL?(i(t.primary),i(t.secondary)):i(t);return t}get activeEditorPane(){return this.editorGroupsContainer.activeGroup?.activeEditorPane}get activeTextEditorControl(){const e=this.activeEditorPane;if(e){const t=e.getControl();if((0,A.z9)(t)||(0,A.Np)(t))return t;if((0,A.Pf)(t)&&(0,A.z9)(t.activeCodeEditor))return t.activeCodeEditor}}get activeTextEditorLanguageId(){let e;const t=this.activeTextEditorControl;return e=(0,A.Np)(t)?t.getModifiedEditor():t,e?.getModel()?.getLanguageId()}get count(){return this.editorsObserver.count}get editors(){return this.getEditors(1).map((({editor:e})=>e))}getEditors(e,t){switch(e){case 0:return t?.excludeSticky?this.editorsObserver.editors.filter((({groupId:e,editor:t})=>!this.editorGroupsContainer.getGroup(e)?.isSticky(t))):this.editorsObserver.editors;case 1:{const e=[];for(const i of this.editorGroupsContainer.getGroups(2))e.push(...i.getEditors(1,t).map((e=>({editor:e,groupId:i.id}))));return e}}}get activeEditor(){const e=this.editorGroupsContainer.activeGroup;return e?e.activeEditor??void 0:void 0}get visibleEditorPanes(){return(0,D.Yc)(this.editorGroupsContainer.groups.map((e=>e.activeEditorPane)))}get visibleTextEditorControls(){const e=[];for(const t of this.visibleEditorPanes){const i=[];t instanceof f.z?(i.push(t.getPrimaryEditorPane()?.getControl()),i.push(t.getSecondaryEditorPane()?.getControl())):i.push(t.getControl());for(const t of i)((0,A.z9)(t)||(0,A.Np)(t))&&e.push(t)}return e}get visibleEditors(){return(0,D.Yc)(this.editorGroupsContainer.groups.map((e=>e.activeEditor)))}async openEditor(e,t,i){let r,o,s=(0,n.ct)(e)?t:e.options;if((0,C.BS)(t)&&(i=t),!(0,n.ct)(e)){const t=await this.editorResolverService.resolveEditor(e,i);if(1===t)return;(0,n.kc)(t)&&(r=t.editor,s=t.options,o=t.group)}if(r||(r=(0,n.ct)(e)?e:await this.textEditorService.resolveTextEditor(e)),!o){let e;const t=this.instantiationService.invokeFunction(L.$,{editor:r,options:s},i);[o,e]=t instanceof Promise?await t:t,e&&(s={...s,activation:e})}return o.openEditor(r,s)}async openEditors(e,t,i){if(i?.validateTrust&&!await this.handleWorkspaceTrust(e))return[];const r=new Map;for(const i of e){let e,o;if(!(0,n.cs)(i)){const r=await this.editorResolverService.resolveEditor(i,t);if(1===r)continue;(0,n.kc)(r)&&(e=r,o=r.group)}if(e||(e=(0,n.cs)(i)?i:{editor:await this.textEditorService.resolveTextEditor(i),options:i.options}),!o){const i=this.instantiationService.invokeFunction(L.$,e,t);[o]=i instanceof Promise?await i:i}let s=r.get(o);s||(s=[],r.set(o,s)),s.push(e)}const o=[];for(const[e,t]of r)o.push(e.openEditors(t));return(0,D.Yc)(await M.HC.settled(o))}async handleWorkspaceTrust(e){const{resources:t,diffMode:i,mergeMode:r}=this.extractEditorResources(e);switch(await this.workspaceTrustRequestService.requestOpenFilesTrust(t)){case 1:return!0;case 2:return await this.hostService.openWindow(t.map((e=>({fileUri:e}))),{forceNewWindow:!0,diffMode:i,mergeMode:r}),!1;case 3:return!1}}extractEditorResources(e){const t=new c.rm;let i=!1,r=!1;for(const o of e)if((0,n.cs)(o)){const e=n.tf.getOriginalUri(o.editor,{supportSideBySide:n.zX.BOTH});p.rz.isUri(e)?t.add(e):e&&(e.primary&&t.add(e.primary),e.secondary&&t.add(e.secondary),i=o.editor instanceof v.p)}else(0,n.CD)(o)&&(p.rz.isUri(o.input1)&&t.add(o.input1.resource),p.rz.isUri(o.input2)&&t.add(o.input2.resource),p.rz.isUri(o.base)&&t.add(o.base.resource),p.rz.isUri(o.result)&&t.add(o.result.resource),r=!0),(0,n.bV)(o)?(p.rz.isUri(o.original.resource)&&t.add(o.original.resource),p.rz.isUri(o.modified.resource)&&t.add(o.modified.resource),i=!0):(0,n.iY)(o)&&t.add(o.resource);return{resources:Array.from(t.keys()),diffMode:i,mergeMode:r}}isOpened(e){return this.editorsObserver.hasEditor({resource:this.uriIdentityService.asCanonicalUri(e.resource),typeId:e.typeId,editorId:e.editorId})}isVisible(e){for(const t of this.editorGroupsContainer.groups)if(t.activeEditor?.matches(e))return!0;return!1}async closeEditor({editor:e,groupId:t},i){const r=this.editorGroupsContainer.getGroup(t);await(r?.closeEditor(e,i))}async closeEditors(e,t){const i=new Map;for(const{editor:t,groupId:r}of e){const e=this.editorGroupsContainer.getGroup(r);if(!e)continue;let o=i.get(e);o||(o=[],i.set(e,o)),o.push(t)}for(const[e,r]of i)await e.closeEditors(r,t)}findEditors(e,t,i){const r=p.rz.isUri(e)?e:e.resource,o=p.rz.isUri(e)?void 0:e.typeId;if(t?.supportSideBySide!==n.zX.ANY&&t?.supportSideBySide!==n.zX.SECONDARY&&!this.editorsObserver.hasEditors(r))return p.rz.isUri(e)||(0,w.b0)(i)?[]:void 0;if((0,w.b0)(i)){const i=[];for(const r of this.editorGroupsContainer.getGroups(1)){const o=[];if(p.rz.isUri(e))o.push(...this.findEditors(e,t,r));else{const i=this.findEditors(e,t,r);i&&o.push(i)}i.push(...o.map((e=>({editor:e,groupId:r.id}))))}return i}{const s="number"==typeof i?this.editorGroupsContainer.getGroup(i):i;if(p.rz.isUri(e))return s?s.findEditors(r,t):[];{if(!s)return;const e=s.findEditors(r,t);for(const t of e)if(t.typeId===o)return t;return}}}async replaceEditors(e,t){const i="number"==typeof t?this.editorGroupsContainer.getGroup(t):t,r=[];for(const t of e){let e;if(!(0,n.ct)(t.replacement)){const r=await this.editorResolverService.resolveEditor(t.replacement,i);if(1===r)continue;(0,n.kc)(r)&&(e={editor:t.editor,replacement:r.editor,options:r.options,forceReplaceDirty:t.forceReplaceDirty})}e||(e={editor:t.editor,replacement:(0,E.Km)(t)?t.replacement:await this.textEditorService.resolveTextEditor(t.replacement),options:(0,E.Km)(t)?t.options:t.replacement.options,forceReplaceDirty:t.forceReplaceDirty}),r.push(e)}return i?.replaceEditors(r)}async save(e,t){Array.isArray(e)||(e=[e]);const i=this.getUniqueEditors(e),r=[],o=[];if(t?.saveAs)o.push(...i);else for(const{groupId:e,editor:t}of i)t.hasCapability(4)?o.push({groupId:e,editor:t}):r.push({groupId:e,editor:t});const s=await M.HC.settled(r.map((({groupId:e,editor:i})=>(1===t?.reason&&this.editorGroupsContainer.getGroup(e)?.pinEditor(i),i.save(e,t)))));for(const{groupId:e,editor:i}of o){if(i.isDisposed())continue;const r=await this.openEditor(i,e),o={pinned:!0,viewState:r?.getViewState()},n=t?.saveAs?await i.saveAs(e,t):await i.save(e,t);if(s.push(n),!n)break;if(!i.matches(n)){const t=i.hasCapability(4)?this.editorGroupsContainer.groups.map((e=>e.id)):[e];for(const e of t)n instanceof d.m?await this.replaceEditors([{editor:i,replacement:n,options:o}],e):await this.replaceEditors([{editor:i,replacement:{...n,options:o}}],e)}}return{success:s.every((e=>!!e)),editors:(0,D.Yc)(s)}}saveAll(e){return this.save(this.getAllModifiedEditors(e),e)}async revert(e,t){Array.isArray(e)||(e=[e]);const i=this.getUniqueEditors(e);return await M.HC.settled(i.map((async({groupId:e,editor:i})=>(this.editorGroupsContainer.getGroup(e)?.pinEditor(i),i.revert(e,t))))),!i.some((({editor:e})=>e.isDirty()))}async revertAll(e){return this.revert(this.getAllModifiedEditors(e),e)}getAllModifiedEditors(e){const t=[];for(const i of this.editorGroupsContainer.getGroups(1))for(const r of i.getEditors(0))r.isModified()&&("boolean"!=typeof e?.includeUntitled&&e?.includeUntitled?.includeScratchpad||!r.hasCapability(512))&&(!e?.includeUntitled&&r.hasCapability(4)||e?.excludeSticky&&i.isSticky(r)||t.push({groupId:i.id,editor:r}));return t}getUniqueEditors(e){const t=[];for(const{editor:i,groupId:r}of e)t.some((e=>e.editor.matches(i)))||t.push({editor:i,groupId:r});return t}dispose(){super.dispose(),this.activeOutOfWorkspaceWatchers.forEach((e=>(0,y.AS)(e))),this.activeOutOfWorkspaceWatchers.clear()}};Q=O=(0,o.C)([(0,o.Q)(1,m.m),(0,o.Q)(2,s._Y),(0,o.Q)(3,u.$),(0,o.Q)(4,S.p),(0,o.Q)(5,x.V),(0,o.Q)(6,P.J),(0,o.Q)(7,_.Y),(0,o.Q)(8,F.ZE),(0,o.Q)(9,T.v),(0,o.Q)(10,U.P)],Q)},26888:(e,t,i)=>{i.d(t,{$:()=>c});var r=i(819),o=i(58544),s=i(80512),n=i(20092),d=i(92449),a=i(68796);function c(e,t,i){const o=e.get(d.m),c=e.get(r.p),g=function(e,t,i,r){let o;const d=(0,s.cs)(e)?e.editor:e,c=e.options;if(t&&"number"!=typeof t)o=t;else if("number"==typeof t&&t>=0)o=i.getGroup(t);else if(t===a.Sd){const e=(0,n.BD)(r);let t=i.findGroup({direction:e});t&&!u(t,d)||(t=i.addGroup(i.activeGroup,e)),o=t}else if(t===a.eV)o=i.createAuxiliaryEditorPart().then((e=>e.activeGroup));else if(!c||"number"!=typeof c.index){const e=i.getGroups(1);if(c?.revealIfVisible)for(const t of e)if(l(t,d)){o=t;break}if(!o&&(c?.revealIfOpened||r.getValue("workbench.editor.revealIfOpen")||(0,s.ct)(d)&&d.hasCapability(8))){let t,i;for(const r of e)if(p(r,d)&&(i||(i=r),!t&&r.isActive(d)&&(t=r)),i&&t)break;o=t||i}}if(!o){let e=i.activeGroup;if(u(e,d)){for(const t of i.getGroups(1))if(!u(t,d)){e=t;break}o=u(e,d)?i.addGroup(e,(0,n.BD)(r)):e}else o=e}return o}(t,i,o,c);return g instanceof Promise?g.then((e=>h(e,t,i,o))):h(g,t,i,o)}function h(e,t,i,r){let s;return r.activeGroup!==e&&t.options&&!t.options.inactive&&t.options.preserveFocus&&"number"!=typeof t.options.activation&&i!==a.Sd&&(s=o.u2.ACTIVATE),[e,s]}function u(e,t){return!!e.isLocked&&!p(e,t)}function l(e,t){return!!e.activeEditor&&e.activeEditor.matches(t)}function p(e,t){for(const i of e.editors)if(i.matches(t))return!0;return!1}},88609:(e,t,i)=>{i.d(t,{E:()=>D});var r=i(92518),o=i(1661),s=i(93152),n=i(79367),d=i(28672),a=i(80512),c=i(49567),h=i(30787),u=i(65965),l=i(23703),p=i(865),g=i(4405),v=i(85412),f=i(19871),E=i(47575),m=i(96485),C=i(63534),S=i(19383),y=i(24821);let D=class extends y.jG{constructor(e,t,i,r,o){super(),this.untitledTextEditorService=e,this.instantiationService=t,this.uriIdentityService=i,this.fileService=r,this.editorResolverService=o,this.editorInputCache=new n.fT,this.fileEditorFactory=s.O.as(a.q5.EditorFactory).getFileEditorFactory(),this.registerDefaultEditor()}registerDefaultEditor(){this._register(this.editorResolverService.registerEditor("*",{id:a.Ie.id,label:a.Ie.displayName,detail:a.Ie.providerDisplayName,priority:C.C8.builtin},{},{createEditorInput:e=>({editor:this.createTextEditor(e)}),createUntitledEditorInput:e=>({editor:this.createTextEditor(e)}),createDiffEditorInput:e=>({editor:this.createTextEditor(e)})}))}async resolveTextEditor(e){return this.createTextEditor(e)}createTextEditor(e){if((0,a.CD)(e))return this.createTextEditor(e.result);if((0,a.bV)(e)){const t=this.createTextEditor(e.original),i=this.createTextEditor(e.modified);return this.instantiationService.createInstance(u.p,e.label,e.description,t,i,void 0)}if((0,a.nM)(e)){const t=this.createTextEditor(e.primary),i=this.createTextEditor(e.secondary);return this.instantiationService.createInstance(l.JL,e.label,e.description,i,t)}const t=e;if(t.forceUntitled||!t.resource||t.resource.scheme===h.ny.untitled){const e={languageId:t.languageId,initialValue:t.contents,encoding:t.encoding};let i;return i=t.resource?.scheme===h.ny.untitled?this.untitledTextEditorService.create({untitledResource:t.resource,...e}):this.untitledTextEditorService.create({associatedResource:t.resource,...e}),this.createOrGetCached(i.resource,(()=>this.instantiationService.createInstance(g.m,i)))}const i=e;if(i.resource instanceof f.rz){const e=i.label||(0,v.P8)(i.resource),t=i.resource,r=this.uriIdentityService.asCanonicalUri(t);return this.createOrGetCached(r,(()=>i.forceFile||this.fileService.hasProvider(r)?this.fileEditorFactory.createFileEditor(r,t,i.label,i.description,i.encoding,i.languageId,i.contents,this.instantiationService):this.instantiationService.createInstance(p.r,r,i.label,i.description,i.languageId,i.contents)),(r=>{r instanceof g.m||(r instanceof p.r?(e&&r.setName(e),i.description&&r.setDescription(i.description),i.languageId&&r.setPreferredLanguageId(i.languageId),"string"==typeof i.contents&&r.setPreferredContents(i.contents)):(r.setPreferredResource(t),i.label&&r.setPreferredName(i.label),i.description&&r.setPreferredDescription(i.description),i.encoding&&r.setPreferredEncoding(i.encoding),i.languageId&&r.setPreferredLanguageId(i.languageId),"string"==typeof i.contents&&r.setPreferredContents(i.contents)))}))}throw new Error(`ITextEditorService: Unable to create texteditor from ${JSON.stringify(e)}`)}createOrGetCached(e,t,i){let r=this.editorInputCache.get(e);return r?(i?.(r),r):(r=t(),this.editorInputCache.set(e,r),o.Jh.once(r.onWillDispose)((()=>this.editorInputCache.delete(e))),r)}};D=(0,r.C)([(0,r.Q)(0,c.g),(0,r.Q)(1,d._Y),(0,r.Q)(2,E.J),(0,r.Q)(3,m.$),(0,r.Q)(4,S.Y)],D)},4405:(e,t,i)=>{i.d(t,{m:()=>C});var r,o=i(92518),s=i(80512),n=i(865),d=i(89519),a=i(1935),c=i(12417),h=i(96485),u=i(85412),l=i(85105),p=i(65693),g=i(53725),v=i(45259),f=i(24821),E=i(13901),m=i(59496);let C=class extends n.f{static{r=this}static{this.ID="workbench.editors.untitledEditorInput"}get typeId(){return r.ID}get editorId(){return s.Ie.id}constructor(e,t,i,r,o,s,n,d,a,c,h){super(e.resource,void 0,r,t,i,o,d,c,h),this.model=e,this.environmentService=s,this.pathService=n,this.textModelService=a,this.modelResolve=void 0,this.modelDisposables=this._register(new f.Cm),this.cachedUntitledTextEditorModelReference=void 0,this.registerModelListeners(e),this._register(this.textFileService.untitled.onDidCreate((e=>this.onDidCreateUntitledModel(e))))}registerModelListeners(e){this.modelDisposables.clear(),this.modelDisposables.add(e.onDidChangeDirty((()=>this._onDidChangeDirty.fire()))),this.modelDisposables.add(e.onDidChangeName((()=>this._onDidChangeLabel.fire()))),this.modelDisposables.add(e.onDidRevert((()=>this.dispose())))}onDidCreateUntitledModel(e){(0,u.n4)(e.resource,this.model.resource)&&e!==this.model&&(this.model=e,this.registerModelListeners(e))}getName(){return this.model.name}getDescription(e=1){if(!this.model.hasAssociatedFilePath){const e=this.resource.path;return e!==this.getName()?e:void 0}return super.getDescription(e)}getTitle(e){if(!this.model.hasAssociatedFilePath){const e=this.getName(),t=this.getDescription();return t&&t!==e?`${e} • ${t}`:e}return super.getTitle(e)}isDirty(){return this.model.isDirty()}getEncoding(){return this.model.getEncoding()}setEncoding(e,t){return this.model.setEncoding(e)}get hasLanguageSetExplicitly(){return this.model.hasLanguageSetExplicitly}get hasAssociatedFilePath(){return this.model.hasAssociatedFilePath}setLanguageId(e,t){this.model.setLanguageId(e,t)}getLanguageId(){return this.model.getLanguageId()}async resolve(){return this.modelResolve||(this.modelResolve=(async()=>{this.cachedUntitledTextEditorModelReference=await this.textModelService.createModelReference(this.resource)})()),await this.modelResolve,this.isDisposed()&&this.disposeModelReference(),this.model}toUntyped(e){const t={resource:this.model.hasAssociatedFilePath?(0,u.hN)(this.model.resource,this.environmentService.remoteAuthority,this.pathService.defaultUriScheme):this.resource,forceUntitled:!0,options:{override:this.editorId}};return"number"==typeof e?.preserveViewState&&(t.encoding=this.getEncoding(),t.languageId=this.getLanguageId(),t.contents=this.model.isModified()?this.model.textEditorModel?.getValue():void 0,t.options.viewState=(0,s.su)(this,e.preserveViewState,this.editorService),"string"!=typeof t.contents||this.model.hasAssociatedFilePath||e.preserveResource||(t.resource=void 0)),t}matches(e){return this===e||(e instanceof r?(0,u.n4)(e.resource,this.resource):!!(0,s.x3)(e)&&super.matches(e))}dispose(){this.modelResolve=void 0,this.disposeModelReference(),super.dispose()}disposeModelReference(){(0,f.AS)(this.cachedUntitledTextEditorModelReference),this.cachedUntitledTextEditorModelReference=void 0}};C=r=(0,o.C)([(0,o.Q)(1,d.a),(0,o.Q)(2,a.L),(0,o.Q)(3,c.I),(0,o.Q)(4,h.$),(0,o.Q)(5,l.P),(0,o.Q)(6,p.S),(0,o.Q)(7,g.U),(0,o.Q)(8,v.b),(0,o.Q)(9,E.U),(0,o.Q)(10,m.p)],C)}}]);